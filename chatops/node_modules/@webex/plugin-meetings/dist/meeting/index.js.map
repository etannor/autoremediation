{"version":3,"sources":["index.js"],"names":["Meeting","attrs","options","namespace","MEETINGS","getMediaStreams","mediaDirection","audioVideo","sharePreferences","sendAudio","sendVideo","sendShare","Media","getUserMedia","then","response","reject","MediaError","resolve","getDevices","id","uuid","v4","correlationId","userId","resource","deviceUrl","roapSeq","ROAP_SEQ_PRE","meetingInfo","members","Members","locusUrl","locus","url","parent","webex","roap","Roap","reconnectionManager","ReconnectionManager","audio","video","meetingFiniteStateMachine","MeetingStateMachine","create","stats","internalStats","convoUrl","sipUri","partner","type","owner","hostId","policy","meetingRequest","MeetingRequest","locusInfo","LocusInfo","updateMeetingObject","bind","mediaProperties","MediaProperties","inMeetingActions","InMeetingActions","isSharing","callEvents","floorGrantPending","mediaQualityMetrics","mqaProcessor","setUpLocusInfoListeners","setUpLocusInfoSelfListener","setUpLocusInfoMeetingListener","setUpLocusFullStateListener","setUpLocusUrlListener","setUpLocusHostListener","setUpLocusSelfListener","setUpLocusParticipantsListener","setUpLocusMediaSharesListener","setUpLocusInfoMeetingInfoListener","setUpLocusInfoAssignHostListener","on","EVENTS","LOCUS_INFO_CAN_ASSIGN_HOST","payload","Trigger","trigger","file","function","EVENT_TRIGGERS","MEETING_ACTIONS_UPDATE","canAssignHost","canLock","getCanLock","canUnlock","getCanUnlock","setCanAssignHost","LOCUSINFO","FULL_STATE_MEETING_STATE_CHANGE","MEETING_STATE_CHANGE","FULL_STATE_TYPE_UPDATE","locusFullStateTypeUpdate","event","trackingId","LoggerProxy","logger","error","identifiers","deviceId","locusId","split","pop","locusStartTime","fullState","lastActive","MQA_STATS","CA_TYPE","Metrics","initMediaPayload","initPayload","getAnalyzerMetricsPrePayload","internal","metrics","submitCallDiagnosticEvents","clientType","config","LOCUS_INFO_UPDATE_SELF","locusSelfUpdate","newSelf","state","MEETING_STATE","STATES","JOINED","share","LOCUS_INFO_UPDATE_HOST","locusHostUpdate","LOCUS_INFO_UPDATE_PARTICIPANTS","locusParticipantsUpdate","LOCUS_INFO_UPDATE_MEDIA_SHARES","current","contentId","disposition","selfId","FLOOR_ACTION","RELEASED","updateShare","receiveShare","locusMediaSharesUpdate","LOCUS_INFO_UPDATE_URL","locusUrlUpdate","MEETING_LOCKED","MEETING_UNLOCKED","MEETING_INFO_UPDATED","info","newCanLock","newCanUnlock","self","moderator","MeetingUtil","canUserLock","canUserUnlock","getCanAssignHost","setCanLock","setCanUnlock","SELF_MUTED_BY_OTHERS","MEETING_SELF_MUTED_BY_OTHERS","SELF_UNADMITTED_GUEST","MEETING_SELF_LOBBY_WAITING","postEvent","eventType","LOBBY_ENTERED","meeting","SELF_ADMITTED_GUEST","MEETING_SELF_GUEST_ADMITTED","LOBBY_EXITED","REMOTE_ANSWERED_DECLINED","remote","DESTROY_MEETING","wirelessShare","shareTrack","onended","stop","shouldLeave","leave","reason","warn","catch","cleanUp","meetingId","object","length","forEach","key","invitee","alertIfActive","addMember","memberIds","admitMembers","memberId","removeMember","mute","muteMember","transferHostToMember","mqaInterval","clearInterval","automaticMetrics","StatsMetrics","getStats","initialize","setStats","setInterval","processMQAData","mqaMetricsInterval","MQAProcessor","DATA_PLACEMENTS","sendRecvData","toLowerCase","endsWith","STATS","SENDER","getSender","RECEIVER","getReceiver","mqa","getMQA","interval","getSlice","process","MEDIA_QUALITY","data","intervalData","getData","override","createStats","log","StatsUtil","generateOptions","CONFIG","WebRTCStats","destroySenders","destroyReceivers","isMuted","isSelf","body","errors","conversationUrl","setSipUri","sipMeetingUri","setLocus","participants","getLocusPartner","_CALL_","person","sipUrl","emailAddress","email","seq","mtgLocus","mediaConnections","mediaId","host","initialSetup","pc","ontrack","streams","remoteStream","MEDIA_READY","EVENT_TYPES","REMOTE_AUDIO","stream","MediaUtil","createMediaStream","getAudioTracks","REMOTE_VIDEO","getVideoTracks","setRemoteShare","REMOTE_SHARE","remoteShare","unsetRemoteStream","stopStream","MEDIA_STOPPED","REMOTE","localStream","getTrack","audioTrack","videoTrack","settings","getSettings","setMediaSettings","echoCancellation","noiseSuppression","mediaSettings","setLocalAudioTrack","setLocalVideoTrack","aspectRatio","frameRate","height","width","LOCAL","localShare","setLocalShareTrack","contentTracks","displaySurface","cursor","screen","MEETING_REMOVED_REASON","USER_ENDED_SHARE_STREAMS","stopShare","LOCAL_SHARE","stopTracks","unsetLocalVideoTrack","unsetLocalShareTrack","reconnection","detection","mercury","ONLINE","reconnect","PeerConnectionManager","close","peerConnection","unsetPeerConnection","off","toggle","ParameterError","MUTED","USER_INTERACTION","mediaType","AUDIO","e","UNMUTED","VIDEO","joinOptions","audioVideoOptions","join","joinResponse","addMedia","mediaResponse","media","local","MEETING_RECONNECTION_STARTING","MEDIA_RECONNECTING","MEETING_RECONNECTION_SUCCESS","MEDIA_RECOVERED","MEETING_RECONNECTION_FAILURE","ReconnectionError","MEDIA_RECONNECTION_FAILED","finally","reset","CALL_INITIATED","pstnAudioType","hostPin","pinCollection","MEETING_STATE_MACHINE","ENDED","RINGING","ring","_JOIN_","resourceId","destination","joinMeetingOptions","fail","mediaCapabilities","rx","share_audio","whiteboard","tx","moveMedia","moveToResource","updateMedia","receiveVideo","receiveAudio","oldCorrelationId","meetings","meetingCollection","set","leaveMeeting","moveMeeting","delete","isGuestUnjoined","guest","MEDIA_CAPABILITIES","validateOptions","setMediaPeerConnection","createPeerConnection","setReconnectListener","setPeerConnectionEvents","preMedia","attachMedia","remoteQualityLevel","setRemoteStream","autoSendMQA","startMediaQualityMetrics","startInternalStats","err","timerCount","joiningTimer","meetingState","FULL_STATE","ACTIVE","Error","sendRoapMediaRequest","sdp","signalingState","SDP","STABLE","canUpdateMedia","previousSendShareStatus","setContentSlides","checkForStopShare","startShare","audioTransceiver","track","previousMediaDirection","sendTrack","receiveTrack","updateTransceiver","transceiver","setLocalTracks","AudioStateMachine","videoTransceiver","VideoStateMachine","previousShareStatus","shareTransceiver","setMediaDirection","_INCOMING_","acknowledgeMeeting","ALERT_DISPLAYED","message","_BUSY_","declineMeeting","decline","LEAVE","canProceed","leaveReason","CLIENT_LEAVE_REQUEST","content","mediaShares","find","element","name","CONTENT","SHARE_INITIATED","changeMeetingFloor","GRANTED","personUrl","uri","resourceUrl","MEETING_STARTED_SHARING_LOCAL","LOCAL_SHARE_FLOOR_GRANTED","SHARE_STOPPED","MEETING_STOPPED_SHARING_LOCAL","startRecording","stopRecording","pauseRecording","resumeRecording","lockMeeting","unlockMeeting","tones","enableDTMF","sendDTMF","level","VIDEO_RESOLUTIONS","errorMessage","updateVideo","QUALITY_LEVELS","setRemoteQualityLevel","StatelessWebexPlugin"],"mappings":"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","file":"index.js","sourcesContent":["import uuid from 'uuid';\nimport {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport Trigger from '../common/events/trigger-proxy';\nimport Roap from '../roap/index';\nimport Media from '../media';\nimport MediaProperties from '../media/properties';\nimport MeetingStateMachine from '../meeting/state';\nimport AudioStateMachine from '../meeting/audio';\nimport VideoStateMachine from '../meeting/video';\nimport LocusInfo from '../locus-info';\nimport PeerConnectionManager from '../peer-connection-manager';\nimport Metrics from '../metrics';\nimport {trigger, mediaType, eventType} from '../metrics/config';\nimport ReconnectionManager from '../reconnection-manager';\nimport MeetingRequest from '../meeting/request';\nimport Members from '../members/index';\nimport MeetingUtil from '../meeting/util';\nimport MediaUtil from '../media/util';\nimport WebRTCStats from '../stats/index';\nimport StatsMetrics from '../stats/metrics';\nimport StatsUtil from '../stats/util';\nimport ReconnectionError from '../common/errors/reconnection';\nimport {\n  MEETINGS,\n  EVENT_TRIGGERS,\n  EVENT_TYPES,\n  EVENTS,\n  FLOOR_ACTION,\n  _BUSY_,\n  _INCOMING_,\n  ONLINE,\n  _CALL_,\n  CONTENT,\n  ROAP_SEQ_PRE,\n  LOCUSINFO,\n  MEETING_STATE_MACHINE,\n  _JOIN_,\n  STATS,\n  MQA_STATS,\n  MEETING_STATE,\n  FULL_STATE,\n  MEETING_REMOVED_REASON,\n  SDP,\n  QUALITY_LEVELS,\n  VIDEO_RESOLUTIONS\n} from '../constants';\nimport ParameterError from '../common/errors/parameter';\nimport MediaError from '../common/errors/media';\nimport MQAProcessor from '../metrics/mqa-processor';\n\nimport InMeetingActions from './in-meeting-actions';\n\n\n/**\n * MediaDirection\n * @typedef {Object} MediaDirection\n * @property {boolean} sendAudio\n * @property {boolean} receiveAudio\n * @property {boolean} sendVideo\n * @property {boolean} receiveVideo\n * @property {boolean} sendShare\n * @property {boolean} receiveShare\n */\n\n/**\n  * AudioVideo\n  * @typedef {Object} AudioVideo\n  * @property {Object} audio\n  * @property {String} audio.deviceId\n  * @property {Object} video\n  * @property {String} video.deviceId\n  */\n\n/**\n   * SharePreferences\n   * @typedef {Object} SharePreferences\n   * @property {Object} [shareConstraints]\n   * @property {Boolean} [highFrameRate]\n   */\n\n/**\n * JoinOptions\n * @typedef {Object} JoinOptions\n * @property {String} [resourceId]\n * @property {String} [hostPin]\n * @property {Boolean} [moderator]\n */\n\n/**\n * SendOptions\n * @typedef {Object} SendOptions\n * @property {Boolean} sendAudio\n * @property {Boolean} sendVideo\n * @property {Boolean} sendShare\n */\n\n/**\n  * Meeting State Change Event\n  * Emitted when ever there is a meeting state change\n  * @event meeting:stateChange\n  * @instance\n  * @type {Object}\n  * @property {String} currentState current state of the meeting\n  * @property {String} previousState previous state of the meeting\n  * @memberof Meeting\n  */\n\n/**\n  * Media Ready Event\n  * Emitted when a stream is ready to be rendered\n  * @event media:ready\n  * @instance\n  * @type {Object}\n  * @property {MediaStream} stream the media stream\n  * @property {String} type what type of stream, remote, local\n  * @memberof Meeting\n  */\n\n/**\n  * Media Stopped Event\n  * Emitted when a stream has stopped sending\n  * @event media:stopped\n  * @instance\n  * @type {Object}\n  * @property {String} type what type of stream, remote, local\n  * @memberof Meeting\n  */\n\n/**\n * Meeting Ringing Event\n * Emitted when this client should play a ringing sound, because this member is getting an incoming meeting\n * or sending out an incoming meeting\n * @event meeting:ringing\n * @instance\n * @type {Object}\n * @property {String} type // INCOMING or JOIN\n * @property {String} id\n * @memberof Meeting\n */\n\n/**\n * Meeting Ringing Stop Event\n * Emitted when this client should stop playing a ringing sound\n * @event meeting:ringingStop\n * @instance\n * @type {Object}\n * @property {Object} type\n * @property {Boolean} type.remoteAnswered\n * @property {Boolean} type.remoteDeclined\n * @property {String} id\n * @memberof Meeting\n */\n\n/**\n * Meeting Started Sharing Local Event\n * Emitted when this member starts sharing\n * @event meeting:startedSharingLocal\n * @instance\n * @type {Object}\n * @memberof Meeting\n */\n\n/**\n * Meeting Stopped Sharing Local Event\n * Emitted when this member stops sharing\n * @event meeting:stoppedSharingLocal\n * @instance\n * @type {Object}\n * @memberof Meeting\n */\n\n/**\n * Meeting Locked Event\n * Emitted when a meeting is locked\n * @event meeting:locked\n * @instance\n * @type {Object}\n * @property {Object} info\n * @memberof Meeting\n */\n\n/**\n * Meeting Unlocked Event\n * Emitted when a meeting is unlocked\n * @event meeting:unlocked\n * @instance\n * @type {Object}\n * @property {Object} info\n * @memberof Meeting\n */\n\n/**\n * Meeting Actions Update Event\n * Emitted when a user can take actions on a meeting such as lock, unlock, assign host\n * @event meeting:actionsUpdate\n * @instance\n * @type {Object}\n * @property {Boolean} canLock\n * @property {Boolean} canUnlock\n * @property {Boolean} canAssignHost\n * @memberof Meeting\n */\n\n/**\n * Meeting Muted By Others Event\n * Emitted when a member is muted by another member\n * @event meeting:self:mutedByOthers\n * @instance\n * @type {Object}\n * @property {Object} payload\n * @memberof Meeting\n */\n\n/**\n * Meeting Self Guest Admitted Event\n * Emitted when a member admitted to the meeting by another member\n * @event meeting:self:guestAdmitted\n * @instance\n * @type {Object}\n * @property {Object} payload\n * @memberof Meeting\n */\n\n/**\n * Meeting Self Lobby Waiting Event\n * Emitted when this member enters the lobby and is waiting for the webex meeting to begin\n * @event meeting:self:lobbyWaiting\n * @instance\n * @type {Object}\n * @property {Object} payload\n * @memberof Meeting\n */\n\n/**\n  * Reconnection Starting Event\n  * Emitted when reconnection of media to the active meeting was successful\n  * @event meeting:reconnectionStarting\n  * @instance\n  * @memberof Meeting\n  */\n\n/**\n  * Reconnection Success Event\n  * Emitted when reconnection of media to the active meeting was successful\n  * @event meeting:reconnectionSuccess\n  * @instance\n  * @type {Object}\n  * @property {Object} reconnect\n  * @memberof Meeting\n  */\n\n/**\n  * Reconnection Failure Event\n  * Emitted when reconnection of media to the active meeting was successful\n  * @event meeting:reconnectionFailure\n  * @instance\n  * @type {Object}\n  * @property {Error} error\n  * @memberof Meeting\n  */\n\n/**\n * @description Meeting is the crux of the plugin\n * @export\n * @class Meeting\n */\nexport default class Meeting extends StatelessWebexPlugin {\n  namespace = MEETINGS;\n\n  /**\n   * @param {Object} attrs\n   * @param {Object} options\n   * @constructor\n   * @memberof Meeting\n  */\n  constructor(attrs, options) {\n    super({}, options);\n    /**\n     * @instance\n     * @type {Object}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.attrs = attrs;\n    /**\n     * @instance\n     * @type {Object}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.options = options;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.id = uuid.v4();\n    this.correlationId = this.id;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.userId = attrs.userId;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.resource = attrs.resource;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.deviceUrl = attrs.deviceUrl;\n    /**\n     * @description set you -1 as default values is 0 (used to idenfify if 1st roap request was sent)\n     * @instance\n     * @type {Number}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.roapSeq = ROAP_SEQ_PRE;\n    /**\n     * @instance\n     * @type {Object}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    // TODO: needs to be defined as a class\n    this.meetingInfo = {};\n    /**\n     * @instance\n     * @type {Members}\n     * @public\n     * @memberof Meeting\n     */\n    this.members = new Members({locusUrl: (attrs.locus && attrs.locus.url)}, {parent: this.webex});\n    /**\n     * @instance\n     * @type {Roap}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.roap = new Roap({}, {parent: this.webex});\n    /**\n     * created later\n     * @instance\n     * @type {ReconnectionManager}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.reconnectionManager = new ReconnectionManager(this);\n    /**\n     * created later\n     * @instance\n     * @type {AudioStateMachine}\n     * @public\n     * @memberof Meeting\n     */\n    this.audio = null;\n    /**\n     * created later\n     * @instance\n     * @type {VideoStateMachine}\n     * @public\n     * @memberof Meeting\n     */\n    this.video = null;\n    /**\n     * @instance\n     * @type {MeetingStateMachine}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.meetingFiniteStateMachine = MeetingStateMachine.create(this);\n    /**\n     * @instance\n     * @type {WebRTCStats}\n     * @public\n     * @memberof Meeting\n     */\n    this.stats = null;\n    /**\n     * @instance\n     * @type {WebRTCStats}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.internalStats = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.convoUrl = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.locusUrl = (attrs.locus && attrs.locus.url) || null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.sipUri = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.partner = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.type = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.owner = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.hostId = null;\n    /**\n     * @instance\n     * @type {String}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.policy = null;\n    /**\n     * @instance\n     * @type {MeetingRequest}\n     * @private\n     * @memberof Meeting\n     */\n    this.meetingRequest = new MeetingRequest({}, options);\n    /**\n     * Passing only info as we send basic info for meeting added event\n     * @instance\n     * @type {MeetingRequest}\n     * @private\n     * @memberof Meeting\n     */\n    this.locusInfo = new LocusInfo(this.updateMeetingObject.bind(this), attrs.locus ? attrs.locus : {}, this.webex, this.id);\n    /**\n     * Passing only info as we send basic info for meeting added event\n     * @instance\n     * @type {MediaProperties}\n     * @public\n     * @memberof Meeting\n     */\n    this.mediaProperties = new MediaProperties();\n    /**\n     * @instance\n     * @type {InMeetingActions}\n     * @public\n     * @memberof Meeting\n    */\n    this.inMeetingActions = new InMeetingActions();\n    /**\n     * @instance\n     * @type {Boolean}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.isSharing = false;\n    /**\n     * @instance\n     * @type {Array}\n     * @readonly\n     * @public\n     * @memberof Meeting\n     */\n    this.callEvents = [];\n    /**\n     * There is a pending floor requested by the user\n     * @instance\n     * @type {floorGrantPending}\n     * @private\n     * @memberof Meeting\n     */\n    this.floorGrantPending = false;\n    /**\n     * @instance\n     * @type {MediaMetrics}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.mediaQualityMetrics = null;\n    /**\n     * @instance\n     * @type {MQAProcessor}\n     * @readonly\n     * @private\n     * @memberof Meeting\n     */\n    this.mqaProcessor = null;\n    this.setUpLocusInfoListeners();\n  }\n\n  /**\n   * Proxy function for all the listener set ups\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusInfoListeners() {\n    // meeting update listeners\n    this.setUpLocusInfoSelfListener();\n    this.setUpLocusInfoMeetingListener();\n    // members update listeners\n    this.setUpLocusFullStateListener();\n    this.setUpLocusUrlListener();\n    this.setUpLocusHostListener();\n    this.setUpLocusSelfListener();\n    this.setUpLocusParticipantsListener();\n    this.setUpLocusMediaSharesListener();\n    this.setUpLocusInfoMeetingInfoListener();\n    this.setUpLocusInfoAssignHostListener();\n  }\n\n  /**\n   * Set up the locus info listener for assign host permissions on a meeting\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusInfoAssignHostListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_CAN_ASSIGN_HOST, (payload) => {\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setUpLocusInfoAssignHostListener'\n        },\n        EVENT_TRIGGERS.MEETING_ACTIONS_UPDATE,\n        {\n          canAssignHost: payload.canAssignHost,\n          canLock: this.inMeetingActions.getCanLock(),\n          canUnlock: this.inMeetingActions.getCanUnlock()\n        }\n      );\n      this.inMeetingActions.setCanAssignHost(payload.canAssignHost);\n    });\n  }\n\n  /**\n   * Set up the internal locus info full state object listener\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusFullStateListener() {\n    this.locusInfo.on(LOCUSINFO.EVENTS.FULL_STATE_MEETING_STATE_CHANGE, (payload) => {\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setUpLocusFullStateListener'\n        },\n        EVENT_TRIGGERS.MEETING_STATE_CHANGE,\n        {\n          payload\n        }\n      );\n    });\n\n    this.locusInfo.on(LOCUSINFO.EVENTS.FULL_STATE_TYPE_UPDATE, (payload) => {\n      this.members.locusFullStateTypeUpdate(payload);\n    });\n  }\n\n  /**\n   * get the metrics payload pre\n   * @param {Object} options\n   * @param {String} options.event\n   * @param {String} options.trackingId\n   * @param {Object} options.locus\n   * @returns {Object}\n   * @memberof Meeting\n   */\n  getAnalyzerMetricsPrePayload(options) {\n    if (options) {\n      const {event, trackingId, locus} = options;\n\n      if (!event) {\n        LoggerProxy.logger.error('Error [Call Analyzer Event', event || '', `]: invalid identifers or event type! ${this.correlationId}`);\n\n        return null;\n      }\n\n      const identifiers = {\n        correlationId: this.correlationId,\n        userId: this.userId,\n        deviceId: this.deviceUrl\n      };\n\n      // If locus is passed take the value from there else use meeting object\n      if (locus) {\n        identifiers.locusId = locus.url.split('/').pop();\n        identifiers.locusStartTime = locus.fullState.lastActive;\n      }\n      else if (this.locusUrl && this.locusInfo.fullState) {\n        identifiers.locusId = this.locusUrl && this.locusUrl.split('/').pop();\n        identifiers.locusStartTime = this.locusInfo.fullState && this.locusInfo.fullState.lastActive;\n      }\n\n      if (options.trackingId) {\n        identifiers.trackingId = trackingId;\n      }\n\n      let payload = {};\n\n      if (options.type === MQA_STATS.CA_TYPE) {\n        payload = Metrics.initMediaPayload(options.event, identifiers, options);\n      }\n\n      else {\n        payload = Metrics.initPayload(options.event, identifiers, options);\n      }\n\n      return payload;\n    }\n\n    return null;\n  }\n\n  /**\n   * Send the metrics to call-analyzer dashboard\n   * @param {Object} options\n   * @param {String} options.event\n   * @param {String} options.trackingId\n   * @param {Object} options.locus\n   * @returns {Promise}\n   * @private\n   * @memberof Meeting\n   */\n  sendCallAnalyzerMetrics(options) {\n    const payload = this.getAnalyzerMetricsPrePayload(options);\n\n    return this.webex.internal.metrics.submitCallDiagnosticEvents(payload);\n  }\n\n  /**\n   * Send the metrics to Media Quality Analyzer dashboard\n   * @param {Object} options\n   * @param {String} options.event\n   * @param {String} options.trackingId\n   * @param {Object} options.locus\n   * @returns {Promise}\n   * @private\n   * @memberof Meeting\n   */\n  sendMediaQualityAnalyzerMetrics(options) {\n    options.type = MQA_STATS.CA_TYPE;\n    options.clientType = this.config.metrics.clientType;\n    const payload = this.getAnalyzerMetricsPrePayload(options);\n\n    return this.webex.internal.metrics.submitCallDiagnosticEvents(payload);\n  }\n\n  /**\n   * Set up the locus info self listener\n   * update self value for members and updates the member\n   * notifies consumer with members:self:update {activeSelfId endedSelfId}\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusSelfListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_UPDATE_SELF, (payload) => {\n      this.members.locusSelfUpdate(payload);\n\n      // If user moved to a JOINED state and there is a pending floor grant trigger it\n      if (this.floorGrantPending && payload.newSelf.state === MEETING_STATE.STATES.JOINED) {\n        this.share()\n          .then(() => { this.floorGrantPending = false; });\n      }\n    });\n  }\n\n  /**\n   * Set up the locus info host listener\n   * update host value for members and updates the member\n   * notifies consumer with members:host:update: {activeHostId, endedHostId}\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusHostListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_UPDATE_HOST, (payload) => {\n      this.members.locusHostUpdate(payload);\n    });\n  }\n\n  /**\n   * Set up the locus info participants update listener\n   * update members collection value for members\n   * notifies consumer with members:update\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusParticipantsListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_UPDATE_PARTICIPANTS, (payload) => {\n      this.members.locusParticipantsUpdate(payload);\n    });\n  }\n\n  /**\n   * Set up the locus info media shares listener\n   * update content sharing id value for members, and updates the member\n   * notifies consumer with members:content:update {activeContentSharingId, endedContentSharingId}\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusMediaSharesListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_UPDATE_MEDIA_SHARES, (payload) => {\n      const {contentId, disposition} = payload.current;\n\n      // Check if screenshare is being taken over by a remote\n      // If so, terminate the share and allow the remote to be on the floor\n      // Terminating the share allows the user to screenshare again without any issues\n      if (\n        this.isSharing &&\n        this.selfId !== contentId &&\n        disposition !== FLOOR_ACTION.RELEASED\n      ) {\n        this.isSharing = false;\n        this.updateShare({\n          sendShare: false,\n          receiveShare: this.mediaProperties.mediaDirection.receiveShare\n        });\n      }\n\n      this.members.locusMediaSharesUpdate(payload);\n    });\n  }\n\n  /**\n   * Set up the locus info url listener\n   * update locus_url value for members\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusUrlListener() {\n    this.locusInfo.on(EVENTS.LOCUS_INFO_UPDATE_URL, (payload) => {\n      this.members.locusUrlUpdate(payload);\n    });\n  }\n\n  /**\n   * Set up the locus info meeting info listener\n   * @returns {undefined}\n   * @private\n   * @memberof meeting\n   */\n  setUpLocusInfoMeetingInfoListener() {\n    this.locusInfo.on(LOCUSINFO.EVENTS.MEETING_LOCKED, (payload) => {\n      if (payload) {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoMeetingInfoListener'\n          },\n          EVENT_TRIGGERS.MEETING_LOCKED,\n          {\n            payload\n          }\n        );\n      }\n    });\n    this.locusInfo.on(LOCUSINFO.EVENTS.MEETING_UNLOCKED, (payload) => {\n      if (payload) {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoMeetingInfoListener'\n          },\n          EVENT_TRIGGERS.MEETING_UNLOCKED,\n          {\n            payload\n          }\n        );\n      }\n    });\n    this.locusInfo.on(LOCUSINFO.EVENTS.MEETING_INFO_UPDATED, (payload) => {\n      if (payload && payload.info) {\n        let newCanLock;\n        let newCanUnlock;\n\n        if (payload.self && !payload.self.moderator) {\n          newCanLock = false;\n          newCanUnlock = false;\n        }\n        else {\n          newCanLock = MeetingUtil.canUserLock(payload.info.moderator, payload.info.policy);\n          newCanUnlock = MeetingUtil.canUserUnlock(payload.info.moderator, payload.info.policy);\n        }\n\n        if (newCanLock && !this.inMeetingActions.canLock) {\n          Trigger.trigger(\n            this,\n            {\n              file: 'meeting/index',\n              function: 'setUpLocusInfoMeetingInfoListener'\n            },\n            EVENT_TRIGGERS.MEETING_ACTIONS_UPDATE,\n            {\n              canLock: true,\n              canUnlock: false,\n              canAssignHost: this.inMeetingActions.getCanAssignHost()\n            }\n          );\n        }\n        if (newCanUnlock && !this.inMeetingActions.canUnlock || !newCanLock) {\n          Trigger.trigger(\n            this,\n            {\n              file: 'meeting/index',\n              function: 'setUpLocusInfoMeetingInfoListener'\n            },\n            EVENT_TRIGGERS.MEETING_ACTIONS_UPDATE,\n            {\n              canLock: false,\n              canUnlock: true,\n              canAssignHost: this.inMeetingActions.getCanAssignHost()\n            }\n          );\n        }\n        this.inMeetingActions.setCanLock(newCanLock || false);\n        this.inMeetingActions.setCanUnlock(newCanUnlock || false);\n      }\n    });\n  }\n\n  /**\n   * Internal function to listen to the self object changes\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusInfoSelfListener() {\n    this.locusInfo.on(LOCUSINFO.EVENTS.SELF_MUTED_BY_OTHERS, (payload) => {\n      if (payload) {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoSelfListener'\n          },\n          EVENT_TRIGGERS.MEETING_SELF_MUTED_BY_OTHERS,\n          {\n            payload\n          }\n        );\n      }\n    });\n    this.locusInfo.on(LOCUSINFO.EVENTS.SELF_UNADMITTED_GUEST, (payload) => {\n      if (payload) {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoSelfListener'\n          },\n          EVENT_TRIGGERS.MEETING_SELF_LOBBY_WAITING,\n          {\n            payload\n          }\n        );\n\n        Metrics.postEvent({\n          event: eventType.LOBBY_ENTERED,\n          meeting: this\n        });\n      }\n    });\n    this.locusInfo.on(LOCUSINFO.EVENTS.SELF_ADMITTED_GUEST, (payload) => {\n      if (payload) {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoSelfListener'\n          },\n          EVENT_TRIGGERS.MEETING_SELF_GUEST_ADMITTED,\n          {\n            payload\n          }\n        );\n\n        Metrics.postEvent({\n          event: eventType.LOBBY_EXITED,\n          meeting: this\n        });\n      }\n    });\n  }\n\n  /**\n   * Add LocusInfo nested object listeners (from child to parent)\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setUpLocusInfoMeetingListener() {\n    this.locusInfo.on(EVENTS.REMOTE_ANSWERED_DECLINED, (payload) => {\n      this.meetingFiniteStateMachine.remote(payload);\n    });\n    this.locusInfo.on(EVENTS.DESTROY_MEETING, (payload) => {\n      // if self state is NOT left\n\n      // TODO: Handle sharing and wireless sharing when meeting end\n      if (this.wirelessShare) {\n        if (this.mediaProperties.shareTrack) {\n          this.mediaProperties.shareTrack.onended = null;\n          this.mediaProperties.shareTrack.stop();\n        }\n      }\n      // when multiple WEB deviceType join with same user\n      // and some of the devices are joined and some are left\n      // when your own device is still connected you want to leave and destroy\n      // else you want to just destroy\n      // this looks odd because when it leaves it should destroy, but we get a\n      // leave response and we should destroy it on the next event loop\n      // the leave response gets parsed and we decide if we want to destroy the meeting\n      // the first time we just leave it, the second time it comes it destroys it from the collection\n      if (payload.shouldLeave) {\n        // TODO:  We should do cleaning of meeting object if the shouldLeave: false because there might be meeting object which we are not cleaning\n\n        this.leave({reason: payload.reason}).then(() => {\n          LoggerProxy.logger.warn('meeting/index->setUpLocusInfoMeetingListener:DESTROY_MEETING#The meeting has been left, but has not been destroyed, you should see a later event for leave.');\n        }).catch((error) => {\n          LoggerProxy.logger.error(`meeting/index->setUpLocusInfoMeetingListener:DESTROY_MEETING#Issue with leave for meeting, meeting still in collection: ${this.meeting}, error: ${error}`);\n        });\n      }\n      else {\n        LoggerProxy.logger.info('MEETING_REMOVED_REASON', payload.reason);\n        MeetingUtil.cleanUp(this);\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setUpLocusInfoMeetingListener'\n          },\n          EVENTS.DESTROY_MEETING,\n          {\n            reason: payload.reason,\n            meetingId: this.id\n          }\n        );\n      }\n    });\n  }\n\n  /**\n   * Set meeting values rather than events\n   * @param {Object} object\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   * // TODO: is this function necessary?\n   */\n  updateMeetingObject(object) {\n    // Validate if these are valid meeting object property\n    // TODO: add a check to make sure the value passed in the constructor\n    // is not changed by any delta event\n    if (object && Object.keys(object).length) {\n      Object.keys(object).forEach((key) => {\n        this[key] = object[key];\n      });\n    }\n  }\n\n  /**\n   * Invite a guest to the call that isn't normally part of this call\n   * @param {Object} invitee\n   * @param {String} invitee.emailAddress\n   * @param {String} invitee.email\n   * @param {Boolean} [alertIfActive]\n   * @returns {Promise} see #members.addMember\n   * @public\n   * @memberof Meeting\n   */\n  invite(invitee, alertIfActive = true) {\n    return this.members.addMember(invitee, alertIfActive);\n  }\n\n  /**\n   * Admit the guest(s) to the call once they are waiting\n   * @param {Array} memberIds\n   * @returns {Promise} see #members.admitMembers\n   * @public\n   * @memberof Meeting\n   */\n  admit(memberIds) {\n    return this.members.admitMembers(memberIds);\n  }\n\n  /**\n   * Remove the member from the meeting, boot them\n   * @param {String} memberId\n   * @returns {Promise} see #members.removeMember\n   * @public\n   * @memberof Meeting\n   */\n  remove(memberId) {\n    return this.members.removeMember(memberId);\n  }\n\n  /**\n   * Mute another member from the meeting\n   * @param {String} memberId\n   * @param {Boolean} mute\n   * @returns {Promise} see #members.muteMember\n   * @public\n   * @memberof Meeting\n   */\n  mute(memberId, mute = true) {\n    return this.members.muteMember(memberId, mute);\n  }\n\n  /**\n   * Transfer the moderator role to another eligible member\n   * @param {String} memberId\n   * @param {Boolean} moderator\n   * @returns {Promise} see #members.transferHostToMember\n   * @public\n   * @memberof Meeting\n   */\n  transfer(memberId, moderator = true) {\n    return this.members.transferHostToMember(memberId, moderator);\n  }\n\n  /**\n   * Reference to the Members object\n   * @returns {Members}\n   * @public\n   * @memberof Meeting\n   */\n  getMembers() {\n    return this.members;\n  }\n\n  /**\n   * If this gets turned off mid meeting after attaching media, it will shut down the MQA metrics and they will\n   * not restart unless the start function is called again\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  cleanMQAInterval() {\n    if (this.mqaInterval) {\n      clearInterval(this.mqaInterval);\n    }\n  }\n\n  /**\n   * Automatically publishes media metrics data and on a config interval\n   * uses the existing getStats data filter, so no new streams are created\n   * but it is separate than history, so history will not be available\n   * @returns {MediaMetrics}\n   * @public\n   * @memberof Meeting\n   */\n  startMediaQualityMetrics() {\n    const automaticMetrics = new StatsMetrics({config: this.config});\n\n    const stats = this.getStats(automaticMetrics.initialize(), true);\n\n    this.mediaQualityMetrics = automaticMetrics;\n\n    this.mediaQualityMetrics.setStats(stats);\n\n    this.mqaInterval = setInterval(() => this.processMQAData(), this.config.metrics.mqaMetricsInterval);\n\n    return automaticMetrics;\n  }\n\n  /**\n   * @private\n   * @returns {undefined}\n   * @memberof Meeting\n   */\n  processMQAData() {\n    if (!this.mqaProcessor) {\n      this.mqaProcessor = new MQAProcessor();\n    }\n\n    MQA_STATS.DATA_PLACEMENTS.forEach((key) => {\n      if (this.mediaQualityMetrics && this.mediaQualityMetrics.stats) {\n        let sendRecvData;\n\n        if (key.toLowerCase().endsWith(STATS.SENDER)) {\n          sendRecvData = this.mediaQualityMetrics.stats.getSender(key);\n        }\n        else if (key.toLowerCase().endsWith(STATS.RECEIVER)) {\n          sendRecvData = this.mediaQualityMetrics.stats.getReceiver(key);\n        }\n        let mqa;\n\n        if (sendRecvData) {\n          mqa = sendRecvData.getMQA();\n        }\n        if (mqa) {\n          const interval = mqa.getSlice(this.config.metrics.mqaMetricsInterval / 1000); // milliseconds -> second based intervals\n\n          this.mqaProcessor.process(key, interval);\n        }\n      }\n    });\n    Metrics.postEvent({event: eventType.MEDIA_QUALITY, meetingId: this.id, data: {intervalData: this.mqaProcessor.getData()}});\n  }\n\n  /**\n   * Reference to the stats builder object\n   * @param {Object} options - see #createStats\n   * @param {Boolean} override - override the previous getStats\n   * @returns {WebRTCStats}\n   * @public\n   * @memberof Meeting\n   */\n  getStats(options, override) {\n    if (!this.stats) {\n      return this.createStats(options);\n    }\n    if (override) {\n      if (this.stats) {\n        LoggerProxy.logger.log('Meeting:index#getStats --> Overriding the previous stats object without destroying first can result in memory leaks.');\n      }\n\n      return this.createStats(options);\n    }\n\n    return this.stats;\n  }\n\n  /**\n   * write the stats builder object and assign to meeting property\n   * @param {Object} options\n   * @returns {WebRTCStats}\n   * @public\n   * @memberof Meeting\n   */\n  createStats(options = {}) {\n    StatsUtil.generateOptions(options, STATS.CONFIG, this);\n\n    options.config = STATS.CONFIG;\n\n    this.stats = new WebRTCStats(this.attrs, this.options, options);\n\n    return this.stats;\n  }\n\n  /**\n   * if you have started a stats instance, here's how you can stop it\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  stopStats() {\n    if (this.stats) {\n      this.stats.destroySenders();\n      this.stats.destroyReceivers();\n      this.stats = null;\n    }\n  }\n\n  /**\n   * Convenience function to tell whether a meeting is muted\n   * @returns {Boolean} if meeting audio muted or not\n   * @public\n   * @memberof Meeting\n   */\n  isAudioMuted() {\n    return this.audio && this.audio.isMuted();\n  }\n\n  /**\n   * Convenience function to tell if the end user last changed the audio state\n   * @returns {Boolean} if audio was manipulated by the end user\n   * @public\n   * @memberof Meeting\n   */\n  isAudioSelf() {\n    return this.audio && this.audio.isSelf();\n  }\n\n  /**\n   * Convenience function to tell whether video is muted\n   * @returns {Boolean} if meeting video is muted or not\n   * @public\n   * @memberof Meeting\n   */\n  isVideoMuted() {\n    return this.video && this.video.isMuted();\n  }\n\n  /**\n   * Convenience function to tell whether the end user changed the video state\n   * @returns {Boolean} if meeting video is muted or not\n   * @public\n   * @memberof Meeting\n   */\n  isVideoSelf() {\n    return this.video && this.video.isSelf();\n  }\n\n  /**\n   * Sets the meeting info on the class instance\n   * @param {Object} meetingInfo\n   * @param {Object} meetingInfo.body\n   * @param {String} meetingInfo.body.conversationUrl\n   * @param {String} meetingInfo.body.locusUrl\n   * @param {String} meetingInfo.body.sipUri\n   * @param {Object} meetingInfo.body.owner\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  parseMeetingInfo(meetingInfo) {\n    // MeetingInfo will be undefined for 1:1 calls\n    if (meetingInfo && meetingInfo.body && !(meetingInfo.errors && meetingInfo.errors.length > 0)) {\n      this.convoUrl = meetingInfo.body.conversationUrl || this.convoUrl;\n      this.locusUrl = meetingInfo.body.locusUrl || this.locusUrl;\n      this.setSipUri(meetingInfo.body.sipMeetingUri || this.sipUri);\n      this.owner = meetingInfo.body.owner || this.owner;\n    }\n  }\n\n  /**\n   * Sets the first locus info on the class instance\n   * @param {Object} locus\n   * @param {String} locus.url\n   * @param {Array} locus.participants\n   * @param {Object} locus.self\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  parseLocus(locus) {\n    if (locus) {\n      this.locusUrl = locus.url;\n      // TODO: move this to parse participants module\n      this.setLocus(locus);\n\n      // check if we can extract this info from partner\n      // Parsing of locus object must be finished at this state\n      if (locus.participants && locus.self) {\n        this.partner = MeetingUtil.getLocusPartner(locus.participants, locus.self);\n      }\n\n      // For webex meeting the sipUrl gets updated in info parser\n      if (!this.sipUri && this.partner && this.type === _CALL_) {\n        this.setSipUri(this.partner.person.sipUrl || this.partner.person.emailAddress || this.partner.person.email);\n      }\n    }\n  }\n\n  /**\n   * Sets the sip uri on the class instance\n   * uses meeting info as precedence\n   * @param {String} sipUri\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setSipUri(sipUri) {\n    // This can be tel no, device id or a sip uri, user Id\n    this.sipUri = sipUri;\n  }\n\n  /**\n   * Set the roap seq on the class instance\n   * @param {Number} seq\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setRoapSeq(seq) {\n    if (seq >= 0) {\n      this.roapSeq = seq;\n    }\n  }\n\n  /**\n   * Set the locus info the class instance\n   * @param {Object} locus\n   * @param {Array} locus.mediaConnections\n   * @param {String} locus.locusUrl\n   * @param {String} locus.locusId\n   * @param {String} locus.mediaId\n   * @param {Object} locus.host\n   * @todo change name to genertic parser\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setLocus(locus) {\n    const mtgLocus = locus.locus || locus;\n\n    // LocusInfo object saves the locus object\n    // this.locus = mtgLocus;\n    this.mediaConnections = locus.mediaConnections;\n    this.locusUrl = locus.locusUrl || locus.url;\n    this.locusId = locus.locusId;\n    this.selfId = locus.selfId;\n    this.mediaId = locus.mediaId;\n    this.hostId = mtgLocus.host ? mtgLocus.host.id : this.hostId;\n    this.locusInfo.initialSetup(mtgLocus);\n  }\n\n  /**\n   * Sets the remote stream on the class instance and emits and\n   * event to developers\n   * @param {Object} pc The remote stream peer connection\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  setRemoteStream(pc) {\n    if (!pc) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    pc.ontrack = (event) => {\n      // eslint-disable-next-line no-warning-comments\n      // TODO: It's possible for media to not be present\n      // so we might need to either\n      // A) wait until we have media flowing\n      // B) trigger a second event when video is flowing\n      LoggerProxy.logger.log(`Meeting:index->setRemoteStream/ontrack#Event received for peerConnection: ${event}`);\n      // const {transceiver} = event;\n      const streams = event.streams[0];\n\n      this.mediaProperties.remoteStream = streams;\n\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setRemoteStream:pc.ontrack'\n        },\n        EVENT_TRIGGERS.MEDIA_READY,\n        {\n          type: EVENT_TYPES.REMOTE_AUDIO,\n          stream: MediaUtil.createMediaStream([this.mediaProperties.remoteStream.getAudioTracks()[0]])\n        }\n      );\n\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setRemoteStream:pc.ontrack'\n        },\n        EVENT_TRIGGERS.MEDIA_READY,\n        {\n          type: EVENT_TYPES.REMOTE_VIDEO,\n          stream: MediaUtil.createMediaStream([this.mediaProperties.remoteStream.getVideoTracks()[0]])\n        }\n      );\n\n      if (this.mediaProperties.remoteStream.getVideoTracks()[1]) {\n        this.mediaProperties.setRemoteShare(MediaUtil.createMediaStream([this.mediaProperties.remoteStream.getVideoTracks()[1]]));\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'setRemoteStream:pc.ontrack'\n          },\n          EVENT_TRIGGERS.MEDIA_READY,\n          {\n            type: EVENT_TYPES.REMOTE_SHARE,\n            stream: this.mediaProperties.remoteShare\n          }\n        );\n      }\n    };\n  }\n\n  /**\n   * Removes the remote stream on the class instance and triggers an event\n   * to developers\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  unsetRemoteStream() {\n    this.mediaProperties.unsetRemoteStream();\n  }\n\n  /**\n   * Removes the remote stream on the class instance and triggers an event\n   * to developers\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  closeRemoteStream() {\n    return Media.stopStream(this.mediaProperties.remoteStream).then(() => {\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'closeRemoteStream'\n        },\n        EVENT_TRIGGERS.MEDIA_STOPPED,\n        {\n          type: EVENT_TYPES.REMOTE\n        }\n      );\n    });\n  }\n\n  /**\n   * Sets the sceen stream on the class instance and triggers and event to developers\n   * @param {Object} pc a peer connection instance for the screen\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  setShareStream(pc) {\n    if (!pc) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    pc.ontrack = (event) => {\n      [this.mediaProperties.remoteShare] = event.streams;\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setShareStream:pc.ontrack'\n        },\n        EVENT_TRIGGERS.MEDIA_READY,\n        {\n          type: EVENT_TYPES.REMOTE_SHARE,\n          stream: this.mediaProperties.remoteShare\n        }\n      );\n    };\n  }\n\n  /**\n   * Sets the local media stream on the class and emits an event to the developer\n   * @param {Stream} localStream the local media stream\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  setLocalTracks(localStream) {\n    if (localStream) {\n      const {audioTrack, videoTrack} = MeetingUtil.getTrack(localStream);\n      let settings = null;\n\n      if (audioTrack) {\n        settings = audioTrack.getSettings();\n        this.mediaProperties.setMediaSettings('audio', {\n          echoCancellation: settings.echoCancellation,\n          noiseSuppression: settings.noiseSuppression\n        });\n\n        LoggerProxy.logger.log('meeting/setLocalTracks: Audio settings.', JSON.stringify(this.mediaProperties.mediaSettings.audio));\n        this.mediaProperties.setLocalAudioTrack(audioTrack);\n      }\n\n      if (videoTrack) {\n        settings = videoTrack.getSettings();\n        this.mediaProperties.setLocalVideoTrack(videoTrack);\n        this.mediaProperties.setMediaSettings('video', {\n          aspectRatio: settings.aspectRatio,\n          frameRate: settings.frameRate,\n          height: settings.height,\n          width: settings.width\n        });\n        LoggerProxy.logger.log('meeting/setLocalTracks: Video settings.', JSON.stringify(this.mediaProperties.mediaSettings.video));\n      }\n\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setLocalTracks'\n        },\n        EVENT_TRIGGERS.MEDIA_READY,\n        {\n          type: EVENT_TYPES.LOCAL,\n          stream: MediaUtil.createMediaStream([this.mediaProperties.audioTrack, this.mediaProperties.videoTrack])\n        }\n      );\n    }\n  }\n\n  /**\n   * Sets the local media stream on the class and emits an event to the developer\n   * @param {Stream} localShare the local media stream\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  setLocalShareTrack(localShare) {\n    let settings = null;\n\n    if (localShare) {\n      this.mediaProperties.setLocalShareTrack(MeetingUtil.getTrack(localShare).videoTrack);\n      const contentTracks = this.mediaProperties.shareTrack;\n\n      if (contentTracks) {\n        settings = contentTracks.getSettings();\n        this.mediaProperties.setMediaSettings('screen', {\n          aspectRatio: settings.aspectRatio,\n          frameRate: settings.frameRate,\n          height: settings.height,\n          width: settings.width,\n          displaySurface: settings.displaySurface,\n          cursor: settings.cursor\n        });\n        LoggerProxy.logger.log('meeting/setLocalTracks: Screen settings.', JSON.stringify(this.mediaProperties.mediaSettings.screen));\n      }\n\n      contentTracks.onended = () => {\n        if (this.wirelessShare) {\n          this.leave({reason: MEETING_REMOVED_REASON.USER_ENDED_SHARE_STREAMS});\n        }\n        else {\n          this.stopShare();\n        }\n      };\n\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'setLocalShareTrack'\n        },\n        EVENT_TRIGGERS.MEDIA_READY,\n        {\n          type: EVENT_TYPES.LOCAL_SHARE,\n          stream: localShare\n        }\n      );\n    }\n  }\n\n  /**\n   * Closes the local stream from the class and emits an event to the developer\n   * @returns {undefined}\n   * @event media:stopped\n   * @public\n   * @memberof Meeting\n   */\n  closeLocalStream() {\n    return Media.stopTracks(this.mediaProperties.audioTrack)\n      .then(() => Media.stopTracks(this.mediaProperties.videoTrack))\n      .then(() => {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'closeLocalStream'\n          },\n          EVENT_TRIGGERS.MEDIA_STOPPED, {\n            type: EVENT_TYPES.LOCAL\n          }\n        );\n      });\n  }\n\n  /**\n   * Closes the local stream from the class and emits an event to the developer\n   * @returns {undefined}\n   * @event media:stopped\n   * @public\n   * @memberof Meeting\n   */\n  closeLocalShare() {\n    return Media.stopTracks(this.mediaProperties.shareTrack).then(() => {\n      Trigger.trigger(\n        this,\n        {\n          file: 'meeting/index',\n          function: 'closeLocalShare'\n        },\n        EVENT_TRIGGERS.MEDIA_STOPPED, {\n          type: EVENT_TYPES.LOCAL_SHARE\n        }\n      );\n    });\n  }\n\n  /**\n   * Removes the local stream from the class and emits an event to the developer\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  unsetLocalVideoTrack() {\n    this.mediaProperties.unsetLocalVideoTrack();\n  }\n\n  /**\n   * Removes the local share from the class and emits an event to the developer\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  unsetLocalShareTrack() {\n    this.mediaProperties.unsetLocalShareTrack();\n  }\n\n  /**\n   * sets up reconnection logic\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   * @todo remove\n   * // TODO: remove??\n   */\n  setReconnectListener() {\n    // TODO: need to test more with the triggers for reconnect, we also need to add triggers based on getStats reports\n    if (this.config.reconnection.detection) {\n      // Client will have a socket manager and handle reconnecting to mercury, when we reconnect to mercury\n      // if the meeting has active peer connections, it should try to reconnect.\n      this.webex.internal.mercury.on(ONLINE, () => {\n        this.reconnect();\n      });\n    }\n  }\n\n  /**\n   * Close the peer connections and remove them from the class. Triggers an event\n   * when each is closed.\n   * @returns {Promise} returns a resolved promise with an array of closed peer connections\n   * @public\n   * @memberof Meeting\n   */\n  closePeerConnections() {\n    return PeerConnectionManager.close(this.mediaProperties.peerConnection);\n  }\n\n  /**\n   * Unsets the peer connections on the class\n   * warning DO NOT CALL WITHOUT CLOSING PEER CONNECTIONS FIRST\n   * @param {PeerConnection} peerConnection\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  unsetPeerConnections() {\n    this.mediaProperties.unsetPeerConnection();\n    if (this.config.reconnection.detection) {\n      this.webex.internal.mercury.off(ONLINE);\n    }\n  }\n\n  /**\n   * Convenience method to set the correlation id for the Meeting\n   * @param {String} id correlation id to set on the class\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  setCorrelationId(id) {\n    this.correlationId = id;\n  }\n\n  /**\n   * Mute the audio for a meeting\n   * @returns {Promise} resolves the data from muting audio {mute, self} or rejects if there is no audio set\n   * @public\n   * @memberof Meeting\n   */\n  muteAudio() {\n    if (!this.audio || (this.audio && !this.audio.toggle)) {\n      return Promise.reject(new ParameterError('no audio control associated to the meeting'));\n    }\n\n    return this.audio.toggle({\n      mute: true,\n      self: true\n    })\n      .then(() => {\n        LoggerProxy.logger.info('meeting/index->muteAudio#Audio mute successful.');\n        Metrics.postEvent({\n          event: eventType.MUTED,\n          meeting: this,\n          data: {trigger: trigger.USER_INTERACTION, mediaType: mediaType.AUDIO}\n        });\n\n        return Promise.resolve();\n      })\n      .catch((e) => {\n        LoggerProxy.logger.error(`meeting/index->muteAudio#Audio mute error ${e}`);\n      });\n  }\n\n  /**\n   * Unmute meeting audio\n   * @returns {Promise} resolves data from muting audio {mute, self} or rejects if there is no audio set\n   * @public\n   * @memberof Meeting\n   */\n  unmuteAudio() {\n    if (!this.audio || (this.audio && !this.audio.toggle)) {\n      return Promise.reject(new ParameterError('no audio control associated to the meeting'));\n    }\n\n    return this.audio.toggle({\n      mute: false,\n      self: true\n    })\n      .then(() => {\n        Metrics.postEvent({\n          event: eventType.UNMUTED,\n          meeting: this,\n          data: {trigger: trigger.USER_INTERACTION, mediaType: mediaType.AUDIO}\n        });\n      });\n  }\n\n  /**\n   * Mute the video for a meeting\n   * @returns {Promise} resolves data from muting video {mute, self} or rejects if there is no video set\n   * @public\n   * @memberof Meeting\n   */\n  muteVideo() {\n    if (!this.video || (this.video && !this.video.toggle)) {\n      return Promise.reject(new ParameterError('no video control associated to the meeting'));\n    }\n\n    return this.video.toggle({\n      mute: true,\n      self: true\n    })\n      .then(() => {\n        Metrics.postEvent({\n          event: eventType.MUTED,\n          meeting: this,\n          data: {trigger: trigger.USER_INTERACTION, mediaType: mediaType.VIDEO}\n        });\n      });\n  }\n\n  /**\n   * Unmute meeting video\n   * @returns {Promise} resolves data from muting video {mute, self} or rejects if there is no video set\n   * @public\n   * @memberof Meeting\n   */\n  unmuteVideo() {\n    if (!this.video || (this.video && !this.video.toggle)) {\n      return Promise.reject(new ParameterError('no audio control associated to the meeting'));\n    }\n    const options = {};\n\n    options.mute = false;\n    options.self = true;\n\n    return this.video.toggle({\n      mute: false,\n      self: true\n    })\n      .then(() => {\n        Metrics.postEvent({\n          event: eventType.UNMUTED,\n          meeting: this,\n          data: {trigger: trigger.USER_INTERACTION, mediaType: mediaType.VIDEO}\n        });\n      });\n  }\n\n  /**\n   * Shorthand function to join AND set up media\n   * @param {Object} options - options to join with media\n   * @param {JoinOptions} [options.joinOptions] - see #join()\n   * @param {MediaDirection} options.mediaSettings - see #addMedia()\n   * @param {AudioVideo} [options.audioVideoOptions] - see #getMediaStreams()\n   * @returns {Promise} -- {join: see join(), media: see addMedia(), local: see getMediaStreams()}\n   * @public\n   * @memberof Meeting\n   * @example\n   * joinWithMedia({\n   *  joinOptions: {resourceId: 'resourceId' },\n   *  mediaSettings: {\n   *   sendAudio: true,\n   *   sendVideo: true,\n   *   sendShare: false,\n   *   receiveVideo:true,\n   *   receiveAudio: true,\n   *   receiveShare: true\n   * }\n   * audioVideoOptions: {\n   *   audio: 'audioDeviceId',\n   *   video: 'videoDeviceId'\n   * }})\n   */\n  joinWithMedia(options = {}) {\n    // TODO: add validations for parameters\n    const {mediaSettings, joinOptions, audioVideoOptions} = options;\n\n    return this.join(joinOptions)\n      .then((joinResponse) =>\n        this.getMediaStreams(mediaSettings, audioVideoOptions).then(([localStream, localShare]) =>\n          this.addMedia({\n            mediaSettings,\n            localShare,\n            localStream\n          }).then((mediaResponse) => ({\n            join: joinResponse,\n            media: mediaResponse,\n            local: [localStream, localShare]\n          }))))\n      .catch((error) => Promise.reject(error));\n  }\n\n  /**\n   * Initiates the reconnection of the media in the meeting\n   * @returns {Promise} resolves with {reconnect} or errors with {error}\n   * @public\n   * @memberof Meeting\n   */\n  reconnect() {\n    if (!this.reconnectionManager || !this.reconnectionManager.reconnect) {\n      throw new ParameterError('Cannot reconnect, ReconnectionManager must first be defined.');\n    }\n    Trigger.trigger(\n      this,\n      {\n        file: 'meeting/index',\n        function: 'reconnect'\n      },\n      EVENT_TRIGGERS.MEETING_RECONNECTION_STARTING\n    );\n    Metrics.postEvent({event: eventType.MEDIA_RECONNECTING, meeting: this});\n\n    return this.reconnectionManager\n      .reconnect(this)\n      .then((reconnect) => {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'reconnect'\n          },\n          EVENT_TRIGGERS.MEETING_RECONNECTION_SUCCESS,\n          {\n            reconnect\n          }\n        );\n        Metrics.postEvent({\n          event: eventType.MEDIA_RECOVERED,\n          meeting: this\n        });\n\n        return Promise.resolve(reconnect);\n      })\n      .catch((error) => {\n        Trigger.trigger(\n          this,\n          {\n            file: 'meeting/index',\n            function: 'reconnect'\n          },\n          EVENT_TRIGGERS.MEETING_RECONNECTION_FAILURE,\n          {\n            error: new ReconnectionError('Reconnection failure event', error)\n          }\n        );\n        Metrics.postEvent({\n          event: eventType.MEDIA_RECONNECTION_FAILED,\n          meeting: this\n        });\n\n        return Promise.reject(new ReconnectionError('Reconnection failure event', error));\n      })\n      .finally((reconnect) => {\n        this.reconnectionManager.reset();\n\n        return Promise.resolve(reconnect);\n      });\n  }\n\n  /**\n   * Specify joining via audio (option: pstn), video, screenshare\n   * @param {JoinOptions} options A configurable options object for joining a meeting\n   * @returns {Promise} the join response\n   * @public\n   * @memberof Meeting\n   * Scenario A: Joining own claimed personal meeting room, don't pass hostPin, do pass moderator\n   * Scenario B: Joining other's claimed personal meeting room, do pass hostPin (if desired to join as host, or nullify), do pass moderator\n   * Scenario C: Joining an unclaimed personal meeting room, -do not- pass hostPin or moderator on first try, -do- pass hostPin and moderator\n   *             if joining as host on second loop, -do not- pass hostPin do pass moderator if joining as guest on second loop\n   * Scenario D: Joining any other way (sip, pstn, convoUrl, link just need to specify resourceId)\n   */\n  join(options = {}) {\n    // If Move or PSTN try merging into one\n    if (false) {\n      Metrics.postEvent({\n        event: eventType.CALL_INITIATED,\n        meeting: this,\n        data: {pstnAudioType: 'DIAL_IN'}\n      });\n    }\n    else {\n      Metrics.postEvent({\n        event: eventType.CALL_INITIATED,\n        meeting: this,\n        data: {trigger: trigger.USER_INTERACTION}\n      });\n    }\n\n    // Should PIN collection be followed by pin propt ???\n    if (options.hostPin) {\n      Metrics.pinCollection({meeting: this});\n    }\n\n    if (this.meetingFiniteStateMachine.state === MEETING_STATE_MACHINE.STATES.ENDED) {\n      this.meetingFiniteStateMachine.reset();\n    }\n    if (this.meetingFiniteStateMachine.state !== MEETING_STATE_MACHINE.STATES.RINGING) {\n      this.meetingFiniteStateMachine.ring(_JOIN_);\n    }\n\n    // TODO: does this really need to be here?\n    if (options.resourceId && this.destination && options.resourceId === this.destination) {\n      this.wirelessShare = true;\n    }\n\n    return MeetingUtil.joinMeetingOptions(this, options).then((join) => {\n      this.meetingFiniteStateMachine.join();\n\n      return Promise.resolve(join);\n    }).catch((error) => {\n      this.meetingFiniteStateMachine.fail(error);\n\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Moves the call to the specified resourceId\n   * @param {String} resourceId\n   * @returns {Promise} once the move has been completed\n   * @public\n   * @memberof Meeting\n   */\n  moveTo(resourceId) {\n    if (!resourceId) {\n      throw new ParameterError('Cannot move call without a resourceId.');\n    }\n\n    Metrics.mediaCapabilities({\n      meeting: this,\n      data: {\n        mediaCapabilities: {\n          rx: {\n            audio: false,\n            share: false,\n            share_audio: false,\n            video: false,\n            whiteboard: false\n          },\n          tx: {\n            audio: false,\n            share: false,\n            share_audio: false,\n            video: false,\n            whiteboard: false\n          }\n        }\n      }\n    });\n    Metrics.moveMedia({meeting: this});\n\n    return MeetingUtil.joinMeetingOptions(this, {resourceId, moveToResource: true}).then(() => {\n      this.meetingFiniteStateMachine.join();\n\n      return this.updateMedia({\n        mediaSettings: {\n          sendVideo: false, receiveVideo: false, sendAudio: false, receiveAudio: false, sendShare: false, receiveShare: false\n        }\n      }).then(() => Promise.resolve(this));\n    }).catch((error) => {\n      this.meetingFiniteStateMachine.fail(error);\n\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Moves the call from the specified resourceId, back to computer\n   * @param {String} resourceId\n   * @returns {Promise} once the move has been completed\n   * @public\n   * @memberof Meeting\n   */\n  moveFrom(resourceId) {\n    if (!resourceId) {\n      throw new ParameterError('Cannot move call without a resourceId.');\n    }\n    const oldCorrelationId = this.correlationId;\n\n    this.id = uuid.v4();\n\n    this.webex.meetings.meetingCollection.set(this);\n\n    Metrics.mediaCapabilities({\n      meeting: this,\n      data: {\n        mediaCapabilities: {\n          rx: {\n            audio: true,\n            share: true,\n            share_audio: true,\n            video: true,\n            whiteboard: true\n          },\n          tx: {\n            audio: true,\n            share: true,\n            share_audio: true,\n            video: true,\n            whiteboard: true\n          }\n        }\n      }\n    });\n    Metrics.moveMedia({meeting: this});\n\n    return MeetingUtil.joinMeetingOptions(this).then((join) => this.getMediaStreams({sendAudio: true, sendVideo: true, sendShare: false})\n      .then(([localStream, localShare]) =>\n        this.updateMedia({\n          mediaSettings: {\n            sendAudio: true, receiveAudio: true, sendVideo: true, receiveVideo: true, sendShare: false, receiveShare: false\n          },\n          localStream,\n          localShare\n        })\n          .then(() => Promise.resolve(join)))\n      .then(() => MeetingUtil.leaveMeeting(this, {resourceId, correlationId: oldCorrelationId, moveMeeting: true})))\n      .then(() => {\n        this.webex.meetings.meetingCollection.delete(oldCorrelationId);\n\n        return Promise.resolve();\n      });\n  }\n\n  /**\n   * Get local media streams based on options passed\n   * @param {MediaDirection} mediaDirection A configurable options object for joining a meeting\n   * @param {AudioVideo} [audioVideo] audio/video object to set audioinput and videoinput devices, see #Media.getUserMedia\n   * @param {SharePreferences} [sharePreferences] audio/video object to set audioinput and videoinput devices, see #Media.getUserMedia\n   * @returns {Promise} see #Media.getUserMedia\n   * @public\n   * @todo should be static, or moved so can be called outside of a meeting\n   * @memberof Meeting\n   */\n  getMediaStreams = (mediaDirection, audioVideo = {}, sharePreferences) => {\n    if (mediaDirection && (mediaDirection.sendAudio || mediaDirection.sendVideo || mediaDirection.sendShare)) {\n      return Media.getUserMedia(mediaDirection, audioVideo, sharePreferences)\n        .then((response) => {\n          if (!response[0] && !response[1]) {\n            return Promise.reject(new MediaError('Was not able to retrive media Stream'));\n          }\n\n          return Promise.resolve(response);\n        });\n    }\n\n    return Promise.reject(new MediaError('Atleaset one of the mediaDirection value should be true'));\n  }\n\n  /**\n   * Get the devices from the Media module\n   * @returns {Promise} resolves to an array of DeviceInfo\n   * @memberof Meetings\n   */\n  getDevices = () => Media.getDevices();\n\n  /**\n   * Specify joining via audio (option: pstn), video, screenshare\n   * @param {Object} options A configurable options object for joining a meeting\n   * @param {Object} options.resourceId pass the deviceId\n   * @param {MediaDirection} options.mediaSettings pass media options\n   * @param {MediaStream} options.localStream\n   * @param {MediaStream} options.localShare\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  addMedia(options = {}) {\n    if (MeetingUtil.isGuestUnjoined(this.locusInfo) && !this.wirelessShare) {\n      return Promise.reject(new MediaError(`To add media, the ${this.guest ? 'guest' : ''} user must be ${this.guest ? 'admitted. Wait to be admitted' : 'joined to the meeting'} to call addMedia`));\n    }\n    const {localStream, localShare, mediaSettings} = options;\n\n    Metrics.postEvent({\n      event: eventType.MEDIA_CAPABILITIES,\n      meeting: this,\n      data: {\n        mediaCapabilities: {\n          rx: {\n            audio: false,\n            share: false,\n            share_audio: false,\n            video: false,\n            whiteboard: false\n          },\n          tx: {\n            audio: false,\n            share: false,\n            share_audio: false,\n            video: false,\n            whiteboard: false\n          }\n        }\n      }\n    });\n\n    return MeetingUtil.validateOptions(options)\n      .then(() => {\n        if (!this.mediaProperties.peerConnection) {\n          this.mediaProperties.setMediaPeerConnection(MediaUtil.createPeerConnection());\n        }\n        this.setReconnectListener();\n        MeetingUtil.setPeerConnectionEvents(this);\n\n        return this.preMedia(localStream, localShare, mediaSettings);\n      })\n      .then(() => Media.attachMedia(this.mediaProperties, {\n        meetingId: this.id,\n        remoteQualityLevel: this.mediaProperties.remoteQualityLevel\n      })\n        .then((peerConnection) => {\n          LoggerProxy.logger.log(`Meeting:index->addMedia#PeerConnection Received from attachMedia ${peerConnection}`);\n          this.setRemoteStream(peerConnection);\n          if (this.config.metrics.autoSendMQA) {\n            this.startMediaQualityMetrics();\n          }\n          MeetingUtil.startInternalStats(this);\n        })\n        .catch((err) => {\n          this.logger.error('Meeting:index#join --> Error joining the call on roap initialization, ', err);\n          throw err;\n        })\n        .then(() => new Promise((resolve, reject) => {\n          let timerCount = 0;\n\n          // eslint-disable-next-line func-names\n          // eslint-disable-next-line prefer-arrow-callback\n          if (this.type === _CALL_) {\n            resolve();\n          }\n          const joiningTimer = setInterval(() => {\n            timerCount += 1;\n            if (this.meetingState === FULL_STATE.ACTIVE) {\n              clearInterval(joiningTimer);\n              resolve();\n            }\n\n            if (timerCount === 4) {\n              clearInterval(joiningTimer);\n              reject(new Error('Meeting is still not active '));\n            }\n          }, 1000);\n        }))\n        .then(() => this.roap\n          .sendRoapMediaRequest({\n            sdp: this.mediaProperties.peerConnection.sdp,\n            roapSeq: this.roapSeq,\n            meeting: this // or can pass meeting ID\n          })\n          .catch((err) => {\n            this.logger.error('Meeting:index#join --> Error joining the call on send roap media request, ', err);\n            throw err;\n          }))\n\n        .then(() => {\n          if (mediaSettings && mediaSettings.sendShare && localShare) {\n            if (this.state === MEETING_STATE.STATES.JOINED) {\n              return this.share();\n            }\n\n            // When the self state changes to JOINED then request the floor\n            this.floorGrantPending = true;\n          }\n\n          return Promise.resolve();\n        }));\n  }\n\n  /**\n   * Informs if the peer connection is in a state that can be updated with updateMedia (audio/video/share)\n   * @returns {Boolean}\n   */\n  canUpdateMedia() {\n    return this.mediaProperties.peerConnection.signalingState === SDP.STABLE;\n  }\n\n  /**\n   * A confluence of updateAudio, updateVideo, and updateShare\n   * this function re-establishes all of the media streams with new options\n   * @param {Object} options\n   * @param {MediaStream} options.localStream\n   * @param {MediaStream} options.localShare\n   * @param {MediaDirection} options.mediaSettings\n   * @returns {Promise}\n   * @todo fix setRemoteStream for updateMedia\n   * @public\n   * @memberof Meeting\n   */\n  updateMedia(options = {}) {\n    if (!this.canUpdateMedia()) {\n      return Promise.reject(new MediaError('The peer connection is currently negotiation an offer. Please wait for a few seconds and try again.'));\n    }\n    const {localStream, localShare, mediaSettings} = options;\n\n    const previousSendShareStatus = this.mediaProperties.mediaDirection.sendShare;\n\n    return MeetingUtil.validateOptions(options)\n      .then(() => this.preMedia(localStream, localShare, mediaSettings))\n      .then(() => Media.updateMedia(this.mediaProperties, {\n        meetingId: this.id,\n        remoteQualityLevel: this.mediaProperties.remoteQualityLevel\n      })\n        .then((peerConnection) => {\n          LoggerProxy.logger.log(`Meeting:index->updateMedia#PeerConnection received from updateMedia, ${peerConnection}`);\n          this.setRemoteStream(peerConnection);\n          if (mediaSettings.receiveShare || localShare) {\n            PeerConnectionManager.setContentSlides(peerConnection);\n          }\n        })\n        .catch((err) => {\n          LoggerProxy.logger.error('Meeting:index#updateMedia --> Error updatedMedia, ', err);\n          throw err;\n        })\n        .then(() =>\n          this.roap\n            .sendRoapMediaRequest({\n              sdp: this.mediaProperties.peerConnection.sdp,\n              roapSeq: this.roapSeq,\n              meeting: this // or can pass meeting ID\n            })\n            .catch((err) => {\n              LoggerProxy.logger.error('Meeting:index#updateMedia --> Error updateMedia on send roap media request, ', err);\n              throw err;\n            }))\n        .then(() => this.checkForStopShare(mediaSettings.sendShare, previousSendShareStatus))\n        .then((startShare) => {\n          // This is a special case if we do an /floor grant followed by /media\n          // we actually get a OFFER from the server and a GLAR condition happens\n          if (startShare) {\n            // We are assuming that the clients are connected when doing an update\n            return this.share();\n          }\n\n          return Promise.resolve();\n        }));\n  }\n\n  /**\n   * Update the main audio streams with new parameters\n   * @param {Object} options\n   * @param {boolean} options.sendAudio\n   * @param {boolean} options.receiveAudio\n   * @param {MediaStream} [stream]\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  updateAudio(options) {\n    if (!this.canUpdateMedia()) {\n      return Promise.reject(new MediaError('The peer connection is currently negotiation an offer. Please wait for a few seconds and try again.'));\n    }\n    const {sendAudio, receiveAudio, stream} = options;\n    const {audioTransceiver} = this.mediaProperties.peerConnection;\n    const track = MeetingUtil.getTrack(stream).audioTrack;\n\n    if (typeof sendAudio !== 'boolean' || typeof receiveAudio !== 'boolean') {\n      return Promise.reject(new ParameterError('Pass sendVideo and receiveVideo parameter'));\n    }\n\n    return MeetingUtil.validateOptions({sendAudio, localStream: stream})\n      .then(() => {\n        let previousMediaDirection = {};\n\n        if (this.mediaProperties.mediaDirection) {\n          previousMediaDirection = {\n            sendTrack: this.mediaProperties.mediaDirection.sendAudio,\n            receiveTrack: this.mediaProperties.mediaDirection.receiveAudio\n          };\n        }\n        else {\n          this.mediaProperties.mediaDirection = {};\n        }\n\n        return MeetingUtil.updateTransceiver(\n          {\n            type: 'audio',\n            sendTrack: options.sendAudio,\n            receiveTrack: options.receiveAudio,\n            track,\n            transceiver: audioTransceiver,\n            peerConnection: this.mediaProperties.peerConnection,\n            previousMediaDirection\n          },\n          {\n            mediaProperties: this.mediaProperties,\n            roapSeq: this.roapSeq,\n            meeting: this,\n            id: this.id\n          }\n        );\n      })\n      .then(() => {\n        this.setLocalTracks(stream);\n        this.mediaProperties.mediaDirection.sendAudio = sendAudio;\n        this.mediaProperties.mediaDirection.receiveAudio = receiveAudio;\n\n        // audio state could be undefined if you have not sent audio before\n        this.audio = this.audio || AudioStateMachine.create(this.mediaProperties.mediaDirection, this);\n      });\n  }\n\n  /**\n   * Update the main video streams with new parameters\n   * @param {Object} options\n   * @param {boolean} options.sendVideo\n   * @param {boolean} options.receiveVideo\n   * @param {MediaStream} options.stream\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  updateVideo(options) {\n    if (!this.canUpdateMedia()) {\n      return Promise.reject(new MediaError('The peer connection is currently negotiation an offer. Please wait for a few seconds and try again.'));\n    }\n    const {sendVideo, receiveVideo, stream} = options;\n    const {videoTransceiver} = this.mediaProperties.peerConnection;\n    const track = MeetingUtil.getTrack(stream).videoTrack;\n\n    if (typeof sendVideo !== 'boolean' || typeof receiveVideo !== 'boolean') {\n      return Promise.reject(new ParameterError('Pass sendVideo and receiveVideo parameter'));\n    }\n\n    return MeetingUtil.validateOptions({sendVideo, localStream: stream})\n      .then(() => MeetingUtil.updateTransceiver({\n        type: 'video',\n        sendTrack: options.sendVideo,\n        receiveTrack: options.receiveVideo,\n        track,\n        transceiver: videoTransceiver,\n        peerConnection: this.mediaProperties.peerConnection,\n        previousMediaDirection: {\n          sendTrack: this.mediaProperties.mediaDirection.sendVideo,\n          receiveTrack: this.mediaProperties.mediaDirection.receiveVideo\n        }\n      },\n      {\n        mediaProperties: this.mediaProperties,\n        roapSeq: this.roapSeq,\n        meeting: this,\n        id: this.id\n      }))\n      .then(() => {\n        this.setLocalTracks(stream);\n        this.mediaProperties.mediaDirection.sendVideo = sendVideo;\n        this.mediaProperties.mediaDirection.receiveVideo = receiveVideo;\n\n        // video state could be undefined if you have not sent video before\n        this.video = this.video || VideoStateMachine.create(this.mediaProperties.mediaDirection, this);\n      });\n  }\n\n  /**\n   * Internal function when stopping a share stream, cleanup\n   * @param {boolean} sendShare\n   * @param {boolean} previousShareStatus\n   * @returns {Promise}\n   * @private\n   * @memberof Meeting\n   */\n  checkForStopShare(sendShare, previousShareStatus) {\n    if (!this.isSharing && sendShare &&\n      !previousShareStatus) {\n      // When user starts sharing\n      // return this.share();\n      return Promise.resolve(true);\n    }\n    if (this.isSharing && !sendShare &&\n      previousShareStatus) {\n      // When user stops sharing\n      return this.stopShare()\n        .then(() => Promise.resolve(false));\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Update the share streams, can be used to start sharing\n   * @param {Object} options\n   * @param {boolean} options.sendShare\n   * @param {boolean} options.receiveShare\n   * @param {MediaStream} [stream]\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  updateShare(options) {\n    if (!this.canUpdateMedia()) {\n      return Promise.reject(new MediaError('The peer connection is currently negotiation an offer. Please wait for a few seconds and try again.'));\n    }\n    const {sendShare, receiveShare, stream} = options;\n    const {shareTransceiver} = this.mediaProperties.peerConnection;\n    const track = MeetingUtil.getTrack(stream).videoTrack;\n\n    if (typeof sendShare !== 'boolean' || typeof receiveShare !== 'boolean') {\n      return Promise.reject(new ParameterError('Pass sendShare and receiveShare parameter'));\n    }\n    const previousSendShareStatus = this.mediaProperties.mediaDirection.sendShare;\n\n    return MeetingUtil.validateOptions({sendShare, localShare: stream})\n      .then(() => this.checkForStopShare(sendShare, previousSendShareStatus))\n      .then((startShare) => MeetingUtil.updateTransceiver({\n        type: 'video',\n        sendTrack: sendShare,\n        receiveTrack: receiveShare,\n        track,\n        transceiver: shareTransceiver,\n        peerConnection: this.mediaProperties.peerConnection,\n        previousMediaDirection: {\n          sendTrack: this.mediaProperties.mediaDirection.sendShare,\n          receiveTrack: this.mediaProperties.mediaDirection.receiveShare\n        }\n      },\n      {\n        mediaProperties: this.mediaProperties,\n        roapSeq: this.roapSeq,\n        meeting: this,\n        id: this.id\n      })\n        .then(() => {\n          if (startShare) {\n            return this.share();\n          }\n\n          return Promise.resolve();\n        }))\n      .then(() => {\n        this.setLocalShareTrack(stream);\n        this.mediaProperties.mediaDirection.sendShare = sendShare;\n        this.mediaProperties.mediaDirection.receiveShare = receiveShare;\n      });\n  }\n\n  /**\n   * Do all the attach media pre set up before executing the actual attach\n   * @param {MediaStream} localStream\n   * @param {MediaStream} localShare\n   * @param {MediaDirection} mediaSettings\n   * @returns {undefined}\n   * @private\n   * @memberof Meeting\n   */\n  preMedia(localStream, localShare, mediaSettings) {\n    // eslint-disable-next-line no-warning-comments\n    // TODO wire into default config. There's currently an issue with the stateless plugin or how we register\n    this.mediaProperties.setMediaDirection(Object.assign(this.config.mediaSettings, mediaSettings));\n    // add a setup a function move the create and setup media in future\n    // TODO: delete old audio and video if stale\n    this.audio = this.audio || AudioStateMachine.create(this.mediaProperties.mediaDirection, this);\n    this.video = this.video || VideoStateMachine.create(this.mediaProperties.mediaDirection, this);\n    // Validation is already done in addMedia so no need to check if the lenght is greater then 0\n    this.setLocalTracks(localStream);\n    this.setLocalShareTrack(localShare);\n  }\n\n  /**\n   * Acknowledge the meeting, outgoing or incoming\n   * @param {String} type\n   * @returns {Promise} resolve {message, ringing, response}\n   * @public\n   * @memberof Meeting\n   */\n  acknowledge(type) {\n    if (!type) {\n      return Promise.reject(new ParameterError('Type must be set to acknowledge the meeting.'));\n    }\n    if (type === _INCOMING_) {\n      return this.meetingRequest\n        .acknowledgeMeeting({\n          locusUrl: this.locusUrl,\n          deviceUrl: this.deviceUrl,\n          id: this.id\n        })\n        .then((response) => Promise.resolve(response))\n        .then((response) => {\n          this.meetingFiniteStateMachine.ring(type);\n          Metrics.postEvent({event: eventType.ALERT_DISPLAYED, meeting: this});\n\n          return Promise.resolve({\n            response\n          });\n        });\n    }\n\n    // TODO: outside of 1:1 incoming, and all outgoing calls\n    return Promise.resolve({\n      message: 'noop'\n    });\n  }\n\n  /**\n   * Decline this meeting\n   * @param {String} reason\n   * @returns {undefined}\n   * @public\n   * @memberof Meeting\n   */\n  decline(reason = _BUSY_) {\n    return MeetingUtil.declineMeeting(this, reason).then((decline) => {\n      this.meetingFiniteStateMachine.decline();\n\n      return Promise.resolve(decline);\n    }).catch((error) => {\n      this.meetingFiniteStateMachine.fail(error);\n\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Leave the current meeting\n   * @param {Object} options leave options\n   * @param {String} options.resourceId the device with which to leave from, empty if just the computer\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  leave(options = {}) {\n    Metrics.postEvent({event: eventType.LEAVE, meeting: this, data: {trigger: trigger.USER_INTERACTION, canProceed: false}});\n    const leaveReason = options.reason || MEETING_REMOVED_REASON.CLIENT_LEAVE_REQUEST;\n\n    return MeetingUtil.leaveMeeting(this, options)\n      .then((leave) => {\n        this.meetingFiniteStateMachine.leave();\n        // TODO: more testing before we remove this code, we are not sure the scenarios for destroy here\n        if (this.wirelessShare || this.guest) {\n          // If screen sharing clean the meeting object\n          Trigger.trigger(\n            this,\n            {\n              file: 'meeting/index',\n              function: 'leave'\n            },\n            EVENTS.DESTROY_MEETING,\n            {\n              reason: options.reason,\n              meetingId: this.id\n            }\n          );\n        }\n        LoggerProxy.logger.log('LEAVE REASON ', leaveReason);\n\n        return Promise.resolve(leave);\n      }).catch((error) => {\n        this.meetingFiniteStateMachine.fail(error);\n\n        return Promise.reject(error);\n      });\n  }\n\n  /**\n   * Start sharing content with server\n   * @returns {Promise} see #meetingRequest.changeMeetingFloor\n   * @private\n   * @memberof Meeting\n   */\n  share() {\n    const content = this.locusInfo.mediaShares.find((element) => element.name === CONTENT);\n\n    if (content && !this.isSharing) {\n      Metrics.postEvent({event: eventType.SHARE_INITIATED, meeting: this});\n\n      return this.meetingRequest.changeMeetingFloor({\n        disposition: FLOOR_ACTION.GRANTED,\n        personUrl: this.locusInfo.self.url,\n        deviceUrl: this.deviceUrl,\n        uri: content.url,\n        resourceUrl: this.resourceUrl\n      })\n        .then(() => {\n          this.isSharing = true;\n          Trigger.trigger(\n            this,\n            {\n              file: 'meeting/index',\n              function: 'share'\n            },\n            EVENT_TRIGGERS.MEETING_STARTED_SHARING_LOCAL,\n          );\n          Metrics.postEvent({event: eventType.LOCAL_SHARE_FLOOR_GRANTED, meeting: this});\n\n          return Promise.resolve();\n        })\n        .catch((e) => {\n          LoggerProxy.logger.error('Meeting/index->share#Error ', e);\n\n          return Promise.reject(e);\n        });\n    }\n\n    return Promise.reject(new ParameterError('Cannot share without content.'));\n  }\n\n  /**\n   * Stops the screen share\n   * @returns {Promise} see #meetingRequest.changeMeetingFloor\n   * @public\n   * @memberof Meeting\n   */\n  stopShare() {\n    const content = this.locusInfo.mediaShares.find((element) => element.name === CONTENT);\n\n    if (content && this.isSharing) {\n      Metrics.postEvent({event: eventType.SHARE_STOPPED, meeting: this});\n      Media.stopTracks(this.mediaProperties.shareTrack);\n\n      return this.meetingRequest.changeMeetingFloor({\n        disposition: FLOOR_ACTION.RELEASED,\n        personUrl: this.locusInfo.self.url,\n        deviceUrl: this.deviceUrl,\n        uri: content.url,\n        resourceUrl: this.resourceUrl\n      })\n        .catch((e) => {\n          LoggerProxy.logger.error('Meeting/index->stopShare#Error ', e);\n\n          return Promise.reject(e);\n        })\n        .finally(() => {\n          this.isSharing = false;\n          Trigger.trigger(\n            this,\n            {\n              file: 'meeting/index',\n              function: 'stopShare'\n            },\n            EVENT_TRIGGERS.MEETING_STOPPED_SHARING_LOCAL,\n          );\n        });\n    }\n\n    return Promise.reject(new ParameterError('Cannot stop share without content'));\n  }\n\n  /**\n   * Intiate a recording of this meeting\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  startRecording() {\n    return MeetingUtil.startRecording(this.meetingRequest, this.locusUrl, this.locusInfo);\n  }\n\n  /**\n   * End the recording of this meeting\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  stopRecording() {\n    return MeetingUtil.stopRecording(this.meetingRequest, this.locusUrl, this.locusInfo);\n  }\n\n  /**\n   * Pauses the recording of this meeting\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  pauseRecording() {\n    return MeetingUtil.pauseRecording(this.meetingRequest, this.locusUrl, this.locusInfo);\n  }\n\n  /**\n   * Resumes the recording of this meeting\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  resumeRecording() {\n    return MeetingUtil.resumeRecording(this.meetingRequest, this.locusUrl, this.locusInfo);\n  }\n\n  /**\n   * Locks the current meeting if possible\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  lockMeeting() {\n    return MeetingUtil.lockMeeting(this.inMeetingActions, this.meetingRequest, this.locusUrl);\n  }\n\n  /**\n   * Unlocks the current meeting if possible\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  unlockMeeting() {\n    return MeetingUtil.unlockMeeting(this.inMeetingActions, this.meetingRequest, this.locusUrl);\n  }\n\n  /**\n   * Sends DTMF tones to the current meeting\n   * @param {String} tones a string of one or more DTMF tones to send\n   * @returns {Promise}\n   * @public\n   * @memberof Meeting\n   */\n  sendDTMF(tones) {\n    const reject = (message) => {\n      LoggerProxy.logger.error(message);\n\n      return Promise.reject(new Error(message));\n    };\n\n    if (this.locusInfo && this.locusInfo.self) {\n      if (this.locusInfo.self.enableDTMF) {\n        return this.meetingRequest\n          .sendDTMF({\n            locusUrl: this.locusInfo.self.url,\n            deviceUrl: this.deviceUrl,\n            tones\n          });\n      }\n\n      return reject('Meeting:index#sendDTMF --> cannot send DTMF, meeting does not have DTMF enabled');\n    }\n\n    return reject('Meeting:index#sendDTMF --> cannot send DTMF, meeting does not have a connection to the \"locus\" call control service. Have you joined?');\n  }\n\n  /**\n   * Sets the quality of the local video stream\n   * @param {String} level {LOW|MEDIUM|HIGH}\n   * @returns {Promise}\n   */\n  setLocalVideoQuality(level) {\n    LoggerProxy.logger.log(`Meeting:index#setLocalVideoQuality --> Setting quality to ${level}`);\n\n    if (!VIDEO_RESOLUTIONS[level]) {\n      const errorMessage = `Meeting:index#setLocalVideoQuality --> ${level} not defined`;\n\n      LoggerProxy.logger.error(errorMessage);\n\n      return Promise.reject(new Error(errorMessage));\n    }\n\n    if (!this.mediaProperties.mediaDirection.sendVideo) {\n      const errorMessage = 'Meeting:index#setLocalVideoQuality --> unable to change video quality, sendVideo is disabled';\n\n      LoggerProxy.logger.error(errorMessage);\n\n      return Promise.reject(new Error(errorMessage));\n    }\n\n    const mediaDirection = {\n      sendAudio: this.mediaProperties.mediaDirection.sendAudio,\n      sendVideo: this.mediaProperties.mediaDirection.sendVideo,\n      sendShare: this.mediaProperties.mediaDirection.sendShare\n    };\n\n    return this.getMediaStreams(mediaDirection, VIDEO_RESOLUTIONS[level])\n      .then(([localStream]) =>\n        this.updateVideo({\n          sendVideo: true,\n          receiveVideo: true,\n          stream: localStream\n        }));\n  }\n\n  /**\n   * Sets the quality level of the remote incoming media\n   * @param {String} level {LOW|MEDIUM|HIGH}\n   * @returns {Promise}\n   */\n  setRemoteQualityLevel(level) {\n    LoggerProxy.logger.log(`Meeting:index#setRemoteQualityLevel --> Setting quality to ${level}`);\n\n    if (!QUALITY_LEVELS[level]) {\n      const errorMessage = `Meeting:index#setRemoteQualityLevel --> ${level} not defined`;\n\n      LoggerProxy.logger.error(errorMessage);\n\n      return Promise.reject(new Error(errorMessage));\n    }\n\n    if (!this.mediaProperties.mediaDirection.receiveAudio && !this.mediaProperties.mediaDirection.receiveVideo) {\n      const errorMessage = 'Meeting:index#setRemoteQualityLevel --> unable to change remote quality, receiveVideo and receiveAudio is disabled';\n\n      LoggerProxy.logger.error(errorMessage);\n\n      return Promise.reject(new Error(errorMessage));\n    }\n\n    // Set the quality level in properties\n    this.mediaProperties.setRemoteQualityLevel(level);\n\n    return this.updateMedia({mediaSettings: this.mediaProperties.mediaDirection});\n  }\n}\n"]}