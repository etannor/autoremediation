{"version":3,"sources":["util.js"],"names":["MeetingUtil","parseLocusJoin","response","parsed","locus","body","mediaConnections","locusUrl","url","locusId","split","pop","selfId","self","id","forEach","mediaConnection","mediaId","remoteUpdateAudioVideo","audioMuted","videoMuted","meeting","reject","ParameterError","localMedias","Media","generateLocalMedias","Metrics","postEvent","event","eventType","MEDIA_REQUEST","meetingRequest","remoteAudioVideoToggle","deviceUrl","correlationId","then","MEDIA_RESPONSE","locusInfo","onFullLocus","checkShare","wirelessShare","isSharing","stopShare","resolve","cleanOptions","options","info","owner","userId","hasOwner","isOwnerSelf","hostPin","moderator","MODERATOR_TRUE","MODERATOR_FALSE","isPinOrGuest","err","errorCode","INTENT_TO_JOIN","joinMeeting","LOCAL_JOIN_REQUEST","sipUri","roapMessage","resourceId","moveToResource","res","LOCUS_JOIN_RESPONSE","data","trigger","LOCI_UPDATE","trackingId","headers","trackingid","cleanUp","closeLocalStream","closeLocalShare","closePeerConnections","unsetLocalVideoTrack","unsetLocalShareTrack","unsetRemoteStream","unsetPeerConnections","cleanMQAInterval","roap","stop","roapSeq","leaveMeeting","defaultOptions","leaveOptions","moveMeeting","catch","LoggerProxy","logger","error","declineMeeting","reason","isGuestUnjoined","parsedLocus","guest","state","_JOINED_","joinMeetingOptions","setCorrelationId","meetingInfo","PIN_COLLECTED","setLocus","PIN_PROMPT","IntentToJoinError","log","JoinMeetingError","updateTransceiver","meetingOptions","type","sendTrack","receiveTrack","track","transceiver","peerConnection","previousMediaDirection","undefined","meetingId","remoteQualityLevel","mediaProperties","sendRoapMediaRequest","sdp","e","sender","replaceTrack","validateOptions","sendVideo","sendAudio","sendShare","localStream","localShare","getTrack","videoTrack","audioTrack","stream","audioTracks","videoTracks","getAudioTracks","getVideoTracks","length","getModeratorFromLocusInfo","getPolicyFromLocusInfo","policy","canUserLock","joined","LOCK_CONTROL_LOCK","LOCK_STATUS_UNLOCKED","canUserUnlock","LOCK_CONTROL_UNLOCK","LOCK_STATUS_LOCKED","canUserRecord","RECORDING_CONTROL_START","canUserPause","RECORDING_CONTROL_PAUSE","canUserResume","RECORDING_CONTROL_RESUME","canUserStop","RECORDING_CONTROL_STOP","startRecording","request","recordMeeting","recording","paused","PermissionError","pauseRecording","resumeRecording","stopRecording","lockMeeting","actions","canLock","lock","unlockMeeting","canUnlock","startInternalStats","internalStats","useConfig","senders","correlate","history","onEvent","kind","stat","Trigger","file","function","EVENT_TRIGGERS","MEETING_MEDIA_LOCAL_STARTED","mediaType","AUDIO","SENDING_MEDIA_START","SENDING_MEDIA_STOP","onData","VIDEO","SHARE","SENDING_SHARE_START","SENDING_SHARE_STOP","receivers","MEETING_MEDIA_REMOTE_STARTED","RECEIVING_MEDIA_START","RECEIVING_MEDIA_STOP","StatsUtil","generateOptions","STATS","CONFIG","config","WebRTCStats","attrs","setPeerConnectionEvents","oniceconnectionstatechange","iceConnectionState","ICE_STATE","CHECKING","ICE_START","COMPLETED","ICE_END","CONNECTED","CLOSED","DISCONNECTED","FAILED","canProceed","errors","generateErrorPayload","name","MEDIA_ENGINE"],"mappings":"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","file":"util.js","sourcesContent":["import {isEmpty} from 'lodash';\n\nimport StatsUtil from '../stats/util';\nimport Metrics from '../metrics';\nimport {eventType, trigger, mediaType, error} from '../metrics/config';\nimport Media from '../media';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport WebRTCStats from '../stats/index';\nimport {\n  INTENT_TO_JOIN,\n  MODERATOR_TRUE,\n  MODERATOR_FALSE,\n  _JOINED_,\n  ICE_STATE,\n  STATS,\n  EVENT_TRIGGERS\n} from '../constants';\nimport Trigger from '../common/events/trigger-proxy';\nimport IntentToJoinError from '../common/errors/intent-to-join';\nimport JoinMeetingError from '../common/errors/join-meeting';\nimport ParameterError from '../common/errors/parameter';\nimport PermissionError from '../common/errors/permission';\n\nconst MeetingUtil = {};\n\nMeetingUtil.parseLocusJoin = (response) => {\n  const parsed = {};\n\n  // First todo: add check for existance\n  parsed.locus = response.body.locus;\n  parsed.mediaConnections = response.body.mediaConnections;\n  parsed.locusUrl = parsed.locus.url;\n  parsed.locusId = parsed.locus.url.split('/').pop();\n  parsed.selfId = parsed.locus.self.id;\n\n  // we need mediaId before making roap calls\n  parsed.mediaConnections.forEach((mediaConnection) => {\n    if (mediaConnection.mediaId) {\n      parsed.mediaId = mediaConnection.mediaId;\n    }\n  });\n\n  return parsed;\n};\n\nMeetingUtil.remoteUpdateAudioVideo = (audioMuted, videoMuted, meeting) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n  const localMedias = Media.generateLocalMedias(meeting.mediaId, audioMuted, videoMuted);\n\n  if (isEmpty(localMedias)) {\n    return Promise.reject(new ParameterError('You need a media id on the meeting to change remote audio.'));\n  }\n\n  Metrics.postEvent({event: eventType.MEDIA_REQUEST, meeting});\n\n  return meeting.meetingRequest.remoteAudioVideoToggle({\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    localMedias,\n    deviceUrl: meeting.deviceUrl,\n    correlationId: meeting.correlationId\n  }).then((response) => {\n    Metrics.postEvent({event: eventType.MEDIA_RESPONSE, meeting});\n    meeting.locusInfo.onFullLocus(response.body.locus);\n  });\n};\n\nMeetingUtil.checkShare = (meeting) => {\n  if ((meeting.wirelessShare && meeting.isSharing) || meeting.isSharing) {\n    return meeting.stopShare();\n  }\n\n  return Promise.resolve();\n};\n\n// TODO: have locus ignore hostPin if they find out it's my claimed PMR\n/*\nfor my claimed PMR\npassing an \"undefined\" hostPin was causing the issue.\nif I don't include hostPin in the first request, locus figures out it's my PMR\nand sends a 200 after the first request\nso we must clean up the hostPin to stop the double request\n*/\nMeetingUtil.cleanOptions = (options, info, owner, userId) => {\n  if (MeetingUtil.hasOwner(info)) {\n    if (MeetingUtil.isOwnerSelf(owner, userId)) {\n      if (options.hostPin) {\n        delete options.hostPin;\n      }\n      options.moderator = MODERATOR_TRUE;\n    }\n    else {\n      options.moderator = MODERATOR_FALSE;\n    }\n  }\n\n  return options;\n};\n\nMeetingUtil.hasOwner = (info) => info && info.owner;\n\nMeetingUtil.isOwnerSelf = (owner, selfId) => owner === selfId;\n\nMeetingUtil.isPinOrGuest = (err) => {\n  if (err && err.body && err.body.errorCode === INTENT_TO_JOIN) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.joinMeeting = (meeting, options) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n\n  Metrics.postEvent({event: eventType.LOCAL_JOIN_REQUEST, meeting});\n\n  // eslint-disable-next-line no-warning-comments\n  // TODO: check if the meeting is in JOINING state\n  // if Joining state termintate the request as user might click multiple times\n  return meeting.meetingRequest\n    .joinMeeting({\n      sipUri: meeting.sipUri,\n      deviceUrl: meeting.deviceUrl,\n      locusUrl: meeting.locusUrl,\n      correlationId: meeting.id,\n      roapMessage: options.roapMessage,\n      resourceId: options.resourceId || null,\n      moderator: options.moderator,\n      hostPin: options.hostPin,\n      moveToResource: options.moveToResource\n    })\n    .then((res) => {\n      Metrics.postEvent({\n        event: eventType.LOCUS_JOIN_RESPONSE,\n        meeting,\n        data: {\n          trigger: trigger.LOCI_UPDATE,\n          locus: res.body.locus,\n          trackingId: res.headers.trackingid\n        }\n      });\n\n      return MeetingUtil.parseLocusJoin(res);\n    });\n};\n\nMeetingUtil.cleanUp = (meeting) => meeting.closeLocalStream()\n  .then(() => meeting.closeLocalShare())\n  .then(() => meeting.closePeerConnections())\n  .then(() => {\n    meeting.unsetLocalVideoTrack();\n    meeting.unsetLocalShareTrack();\n    meeting.unsetRemoteStream();\n    meeting.unsetPeerConnections();\n    meeting.cleanMQAInterval();\n  })\n  .then(() => meeting.roap.stop(meeting.correlationId, meeting.roapSeq));\n\n// by default will leave on meeting's resourceId\n// if you explicity want it not to leave on resource id, pass\n// {resourceId: null}\n// TODO: chris, you can modify this however you want\nMeetingUtil.leaveMeeting = (meeting, options = {}) => {\n  const defaultOptions = {\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    correlationId: meeting.correlationId,\n    resourceId: meeting.resourceId,\n    deviceUrl: meeting.deviceUrl\n  };\n\n  const leaveOptions = {...defaultOptions, ...options};\n\n  return meeting.meetingRequest\n    .leaveMeeting(leaveOptions)\n    .then((response) => {\n      if (response && response.body && response.body.locus) { // && !options.moveMeeting) {\n        meeting.locusInfo.onFullLocus(response.body.locus);\n      }\n\n      return Promise.resolve();\n    })\n    .then(() => {\n      if (options.moveMeeting) {\n        return Promise.resolve();\n      }\n\n      return MeetingUtil.cleanUp(meeting);\n    })\n    .catch((err) => {\n      LoggerProxy.logger.error(\n        `MeetingUtil->leaveMeeting#An error occured while trying to leave meeting with an id of ${\n          meeting.id\n        }, error: ${err}`\n      );\n\n      return Promise.reject(err);\n    });\n};\nMeetingUtil.declineMeeting = (meeting, reason) =>\n  meeting.meetingRequest.declineMeeting({\n    locusUrl: meeting.locusUrl,\n    deviceUrl: meeting.deviceUrl,\n    reason\n  });\n\nMeetingUtil.isGuestUnjoined = (locusInfo) =>\n  locusInfo.parsedLocus && locusInfo.parsedLocus.self && locusInfo.parsedLocus.self.guest && locusInfo.parsedLocus.self.state !== _JOINED_;\n\nMeetingUtil.joinMeetingOptions = (meeting, options = {}) => {\n  meeting.resourceId = meeting.resourceId || options.resourceId;\n  meeting.setCorrelationId(meeting.id);\n  // TODO: this should be removed following locus changes.\n  options = MeetingUtil.cleanOptions(options, meeting.meetingInfo, meeting.owner, meeting.userId);\n\n\n  if (options.hostPin) {\n    Metrics.postEvent({\n      event: eventType.PIN_COLLECTED,\n      meeting\n    });\n  }\n\n  // normal join meeting, scenario A, D\n  return MeetingUtil.joinMeeting(meeting, options)\n    .then((response) => {\n      meeting.setLocus(response);\n\n      return Promise.resolve(response);\n    })\n    .catch((err) => {\n      // joining a claimed PMR that is not my own, scenario B\n      if (MeetingUtil.isPinOrGuest(err)) {\n        if (MeetingUtil.hasOwner(meeting.meetingInfo)) {\n          return MeetingUtil.joinMeeting(meeting, options).then((response) => {\n            meeting.setLocus(response);\n\n            return Promise.resolve();\n          });\n        }\n\n        Metrics.postEvent({\n          event: eventType.PIN_PROMPT,\n          meeting\n        });\n\n        // request host pin or non host for unclaimed PMR, start of Scenario C\n        // see https://sqbu-github.cisco.com/WebExSquared/locus/wiki/Locus-Lobby-and--IVR-Feature\n        return Promise.reject(new IntentToJoinError('Error Joining Meeting', err));\n      }\n      LoggerProxy.logger.log('Meeting:index#join --> Error joining the call, ', err);\n\n      return Promise.reject(new JoinMeetingError(options, 'Error Joining Meeting', err));\n    });\n};\n\nMeetingUtil.updateTransceiver = (options, meetingOptions) => {\n  const {\n    type,\n    sendTrack,\n    receiveTrack,\n    track,\n    transceiver,\n    peerConnection,\n    previousMediaDirection\n  } = options;\n\n  if ((sendTrack !== undefined && sendTrack !== previousMediaDirection.sendTrack) ||\n  (receiveTrack !== undefined && receiveTrack !== previousMediaDirection.receiveTrack)) {\n    return Media.updateTransceiver({\n      meetingId: meetingOptions.meeting.id,\n      remoteQualityLevel: meetingOptions.mediaProperties.remoteQualityLevel\n    }, peerConnection, transceiver,\n    {\n      track,\n      type,\n      receiveTrack,\n      sendTrack\n    })\n      .then(() => meetingOptions.meeting.roap\n        .sendRoapMediaRequest({\n          sdp: meetingOptions.mediaProperties.peerConnection.sdp,\n          roapSeq: meetingOptions.roapSeq,\n          meeting: meetingOptions.meeting // or can pass meeting ID\n        }))\n      .catch((e) => {\n        LoggerProxy.logger.error(`Meeting:index->updateTransceiver#Error updating the ${type} streams with error: ${e}`);\n      });\n  } if (track) {\n    transceiver.sender.replaceTrack(track);\n\n    return Promise.resolve();\n  }\n\n  return Promise.reject(new ParameterError('update Failed: please pass valid parameter'));\n};\n\nMeetingUtil.validateOptions = (options) => {\n  const {\n    sendVideo, sendAudio, sendShare, localStream, localShare\n  } = options;\n\n  if (sendVideo && !MeetingUtil.getTrack(localStream).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid video streams'));\n  }\n\n  if (sendAudio && !MeetingUtil.getTrack(localStream).audioTrack) {\n    return Promise.reject(new ParameterError('please pass valid audio streams'));\n  }\n\n  if (sendShare && !MeetingUtil.getTrack(localShare).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid share streams'));\n  }\n\n  return Promise.resolve();\n};\n\nMeetingUtil.getTrack = (stream) => {\n  let audioTrack = null;\n  let videoTrack = null;\n  let audioTracks = null;\n  let videoTracks = null;\n\n  if (!stream) {\n    return {audioTrack: null, videoTrack: null};\n  }\n  if (stream.getAudioTracks) {\n    audioTracks = stream.getAudioTracks();\n  }\n  if (stream.getVideoTracks) {\n    videoTracks = stream.getVideoTracks();\n  }\n\n  if (audioTracks && audioTracks.length > 0) {\n    [audioTrack] = audioTracks;\n  }\n\n  if (videoTracks && videoTracks.length > 0) {\n    [videoTrack] = videoTracks;\n  }\n\n  return {audioTrack, videoTrack};\n};\n\nMeetingUtil.getModeratorFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.moderator;\n\nMeetingUtil.getPolicyFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.policy;\n\nMeetingUtil.canUserLock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_LOCK && joined.LOCK_STATUS_UNLOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserUnlock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_UNLOCK && joined.LOCK_STATUS_LOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserRecord = (moderator) => moderator.RECORDING_CONTROL_START;\n\nMeetingUtil.canUserPause = (moderator) => moderator.RECORDING_CONTROL_PAUSE;\n\nMeetingUtil.canUserResume = (moderator) => moderator.RECORDING_CONTROL_RESUME;\n\nMeetingUtil.canUserStop = (moderator) => moderator.RECORDING_CONTROL_STOP;\n\nMeetingUtil.startRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserRecord(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Start recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.pauseRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserPause(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: true});\n  }\n\n  return Promise.reject(new PermissionError('Pause recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.resumeRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserResume(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Resume recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.stopRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserStop(moderator)) {\n    return request.recordMeeting({locusUrl, recording: false, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Stop recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.lockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canLock) {\n    return request.lockMeeting({locusUrl, lock: true});\n  }\n\n  return Promise.reject(new PermissionError('Lock not allowed, due to joined property.'));\n};\n\nMeetingUtil.unlockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canUnlock) {\n    return request.lockMeeting({locusUrl, lock: false});\n  }\n\n  return Promise.reject(new PermissionError('Unlock not allowed, due to joined property.'));\n};\n\nMeetingUtil.startInternalStats = (meeting) => {\n  if (!meeting.internalStats) {\n    const options = {\n      useConfig: true,\n      senders: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            // TODO: we don't need checks like this since it comes from the transceiver\n            // refactor event linkage to use callbacks instead of events\n            if (event.kind === 'audio' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ],\n      receivers: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'audio' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ]\n    };\n\n    StatsUtil.generateOptions(options, STATS.CONFIG, meeting);\n\n    options.config = STATS.CONFIG;\n\n    // pass the attrs and options for the webex instance\n    meeting.internalStats = new WebRTCStats(meeting.attrs, meeting.options, options);\n  }\n\n  return meeting.internalStats;\n};\n\nMeetingUtil.setPeerConnectionEvents = (meeting) => {\n  // In case ICE fail\n  const {peerConnection} = meeting.mediaProperties;\n\n  peerConnection.oniceconnectionstatechange = () => {\n    switch (peerConnection.iceConnectionState) {\n      case ICE_STATE.CHECKING:\n        Metrics.postEvent({event: eventType.ICE_START, meeting});\n        break;\n      case ICE_STATE.COMPLETED:\n        Metrics.postEvent({event: eventType.ICE_END, meeting});\n        break;\n      case ICE_STATE.CONNECTED:\n        break;\n      case ICE_STATE.CLOSED:\n        break;\n      case ICE_STATE.DISCONNECTED:\n\n        break;\n      case ICE_STATE.FAILED:\n        // notify of ice failure\n        Metrics.postEvent({\n          event: eventType.ICE_END,\n          meeting,\n          data: {\n            canProceed: false,\n            errors: [\n              Metrics.generateErrorPayload(\n                2004, false, error.name.MEDIA_ENGINE\n              )]\n          }\n        });\n        break;\n      default:\n        break;\n    }\n  };\n};\n\nexport default MeetingUtil;\n"]}